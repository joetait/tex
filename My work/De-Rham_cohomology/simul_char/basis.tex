% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[draft, 11pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margins=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
% read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options
\usepackage[obeyDraft]{todonotes}

\usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{mathtools}
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...

\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true,factor=1100,stretch=10,shrink=10]{microtype}
\microtypecontext{spacing=nonfrench}
% activate={true,nocompatibility} - activate protrusion and expansion
% final - enable microtype; use "draft" to disable
% tracking=true, kerning=true, spacing=true - activate these techniques
% factor=1100 - add 10% to the protrusion amount (default is 1000)
% stretch=10, shrink=10 - reduce stretchability/shrinkability (default is 20/20)

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{amsopn}
\usepackage{amssymb}
\usepackage{natbib}
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

%Theorems and stuff
\theoremstyle{plain}
\newtheorem{defn}{Definition}[section]
\newtheorem{thm}[defn]{Theorem}
\newtheorem{cor}[defn]{Corollary}
\newtheorem{lem}[defn]{Lemma}
\newtheorem{prop}[defn]{Proposition}
\newtheorem{ex}[defn]{Example}
\newtheorem*{unnumthm}{Theorem}
\newtheorem{defnlem}[defn]{Definition/Lemma}
\newtheorem{defnthm}[defn]{Theorem/Definition}
\theoremstyle{remark}
\newtheorem*{rem}{Remark}


\newcommand{\cO}{{\cal O}}
\newcommand{\ra}{\rightarrow}
\newcommand{\NN}{{\mathbb N}}
\newcommand{\PP}{{\mathbb P}}
\newcommand{\ZZ}{{\mathbb Z}}
\newcommand{\cL}{{\mathcal L}}
\newcommand{\cA}{{\mathcal A}}
\newcommand{\cD}{{\mathcal D}}
\newcommand{\cU}{{\mathcal U}}
\newcommand{\cech}{\v{C}ech }
\newcommand{\hzero}{{H^0(X,\Omega_X)}}
\newcommand{\hone}{H^1(X,\mathcal{O}_X)}
\newcommand{\cechhone}{\check{H}^1(\mathcal U,\mathcal O_X)}
\newcommand{\derhamone}{H_{\text {dR}}^1(X/k)}


\DeclareMathOperator{\aut}{Aut}
\DeclareMathOperator{\res}{Res}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\di}{div}
\DeclareMathOperator{\cha}{char}
\DeclareMathOperator{\gal}{Gal}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\Ima}{Im}

%%% END Article customizations

%%% The "real" document content comes below...

\title{Group actions on de-Rham cohomology of hyperelliptic curves}
\author{}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed

\begin{document}
\maketitle

\section{Background}

\todo[inline]{check cech and derham cohomology are the right way round}
\todo{hi}
Let $X$ be a smooth, projective, connected hyperelliptic curve of genus $g \geq 2$ over an algebraically closed field $k$ of characteristic $p \geq 0$.
By an automorphism of $ \mathbb P_k^1$ we may assume that 0 and $\infty$ are branch points of the corresponding double cover $\pi : X \rightarrow \mathbb P_k^1$.
We denote the ramification points in $X$ of 0 and $\infty$ by $P_0$ and $P_\infty$ respectively.
We also suppose that we have a finite group $G$ acting on $X$. \todo{check how it should act - properly etc?}

We will be using \cech cohomology to compute both $\hone$ and the de-Rham hypercohomology.
We therefore recall the \cech cohomology relevant to both of these, starting with $\hone$.

By Leray's theorem {\todo{find citation} and Serre's affineness criterion \todo{citation} we know that the first \cech cohomology group and $\hone$ will be isomorphic if the cover we use to compute the \cech cohomology is affine.
Therefore the cover we shall be using is $U_1 = X\backslash \{ P_0 \}$ and $U_2 = X\backslash \{ P_\infty \}$, and we let ${\cal U} = \{ U_1, U_2\}$.
Given any sheaf $\cal F$ on $X$ we have a canonical map ${\cal F}(U_0) \times {\cal F} (U_1) \rightarrow {\cal F}(U_0 \cap U_1)$ given by taking the difference, $(f_0,f_1) \mapsto f_0|_{U_0 \cap U_1} - f_1|_{U_0 \cap U_1}$.
It is this map which gives us the differential maps in the \cech cochain
\begin{equation*}
0 \rightarrow \cO_X(U_1)\times \cO_X(U_2) \xrightarrow{d} \cO_X(U_1 \cap U_2) \rightarrow 0.
\end{equation*}

Then $\\cechhone = \frac{\cO_X(U_1 \cap U_2)}{\Ima(d)}$ and hence
\begin{equation}
\hone \cong \frac{\cO_X(U_1 \cap U_2)}{\Ima(d)}  
 = \frac{\cO_X(U_1 \cap U_2)}{\{f_1 - f_2 | f_i \in \cO_X(U_i) \}}.
\end{equation}
We will use this characterisation of $\hone$ later.

We now recall how we compute the algebraic de-Rham cohomology of $X$ via \cech cohomology.
The de-Rham cohomology of an algebraic curve is the hypercohomology of the de Rham complex on $X$. 
Since a curve doesn't have differentials of degree greater than one, this is just the hypercohomology of the complex
\begin{equation}\label{res}
0 \rightarrow \cO_X \rightarrow \Omega_X \rightarrow 0.
\end{equation}

We then use the same open cover and the same differentials as defined earlier to give us the \cech complex of \eqref{res}, which is
\begin{equation}\label{bicomplex} \begin{array}{ccccccc}
~ & ~ & 0 & ~ & 0 & ~ & ~ \\
~ & ~ & \downarrow & ~ & \downarrow & ~ & ~ \\
0 & \rightarrow & \cO_X(U_0)\times \cO_X(U_1) & \rightarrow & \Omega_X(U_1)\times \Omega_X(U_2) & \rightarrow & 0 \\
~ & ~ & \downarrow & ~ & \downarrow & ~ & ~ \\
0 & \rightarrow & \cO_X(U_1 \cap U_2) & \rightarrow & \Omega_X(U_1 \cap U_2) & \rightarrow & 0 \\
~ & ~ & \downarrow & ~ & \downarrow & ~ & ~ \\
~ & ~ & 0 & ~ & 0 & ~ & ~ \\
\end{array}
\end{equation}
where the horizontal arrows are the standard differential map $d$.
By \cite[Cor. 12.4.7]{EGA0III}, a generalisation of Leray's theorem, we know that the $\hone$ is isomorphic to the first cohomology of the total complex of \eqref{bicomplex}.
Note that this relies on ${\check H}^p({\mathcal U},\cO_X)$ and ${\check H}^p(\cU, \cO_X)$ being zero for all $p\geq 1$ ---
since $U_1$ and $U_2$ are affine, this follows from Serre's affineness criterion \cite[Thm 5.2.23]{liu}.



Upon computing $H^1_{{\text dR}}(X/k)$ using this complex we see that it is the space
\begin{equation}\label{derhamconditions}
\{(\omega_1, \omega_2, f_{12}) | \omega_i\in \Omega_{X/k}(U_i), f_{12}\in \cO_X(U_1 \cap U_2), df_{12} = \omega_1|_{U_1\cap U_2} - \omega_2|_{U_1\cap U_2} \}
\end{equation}

quotiented by the subspace
\[
\{ (df_1, df_2, f_1|_{U_1\cap U_2} -f_2|_{U_1\cap U_2} )|f_i \in \cO_X(U_i)\}.
\]
In what follows we will not explicitly write when we are taking restrictions of elements, unless it appears that it will add clarity to the situation.

We wish to compute a basis of $H^1_{{\text dR}}(X/k)$, in order that we can see how $G$ acts on $H^1_{{\text dR}}(X/k)$.
To do this we will compute bases for the two outer terms of the short exact sequence
\begin{equation}\label{ses}
0 \ra H^0(X,\Omega_X) \ra \cechhone \ra H^1(X,\cO_X) \ra 0.
\end{equation}
A basis of $H^0(X,\Omega_X)$ is already known in the literature (see, for example, \cite[Prop. 7.4.26]{liu}) so we need only compute a basis of $H^1(X,\cO_X)$.

In order to do this we will need to use Serre duality, which we briefly remind the reader of presently.
Serre duality states that $H^0(X,\Omega_X)$ and $H^1(X,\cO_X)$ are dual to each other, and that there is a canonical map ${\text Res}:H^0(X,\omega_X) \times H^1(X,\cO_X) \rightarrow k$.
Details of the definition of ${\text Res}$ can be found in appendix B of \todo{in progress}
\todo[inline]{add details - in particular, relate to the basis we have for de rham}

\section{Basis of $\cechhone$}

The bases of the $k$-vector spaces in \eqref{ses} will be given in terms of defining equations, so we describe these now.

If $p \neq 2$ then the extension $K(X)$ of $k(x)$ will be $k(x,y)$ where $y$ satisfies
\[
y^2 = f(x)
\]
for some polynomial $f \in k[x]$.
\todo{consistent f(x) or just f}
Since we assumed that $\infty$ is a branch point $f(x)$ is necessarily of degree $2g+1$.\todo{citation}

We let $R$ be the ramification divisor of $\pi$.
We recall that $R = \di(y) + 2(g+1)[P_\infty]$\todo{consider switching R and y} and that $\di( dx) = R - 4[P_\infty]$.

On the other hand, if $p=2$, then the extension $K(X)$ will be $k(x,y)$, this time with $y$ defined by
\[
y^2 - H(x)y = F(x),
\]
for some $H,F \in k[x]$, such that $H(x)$ and $H'(x)^2F(x) + F'(x)^2$ share no roots.
Also, as noted in \cite[\S 6]{faithfulaction}\todo{more accurate citation - may be best to reference 18 month}, we may assume that $F(x)$ is not divisible by $x^2$.

Again, we let $R$ denote the ramification divisor, which we write explicilty below.
In what follows it will be clear from context which characteristic we are in whenever referring to $R$, and hence which ramification divisor is being considered at any time.\todo{edit}
We now recall the following divisors, which we will make use of throughout this article:
\begin{align}
\di (dx) & = R - 4[P_\infty] \\
\di (H(x)) & = R - 2(g+1)[P_\infty] \\
\di (x) & = 2[P_0] - 2[P_\infty]\\
\di (y) & = \di_0(y) - (2g+1)[P_\infty],
\end{align}
where $\di_0$ of a function denotes the divisor of zeroes of a function, or the positive part of the divisor of the function.
Finally, the ramification points we suppose that $H(x) = \prod_{i=1}^d (x-a_i)^{n_i}$ for some $d \leq g$, $a_i \in  k$ and $n_i \in \mathbb N$.
Then the $a_i \in \mathbb P_k^1$ are the branch points of $x$ and we let $P_i \in X$ be the corresponding ramification points of $x$.
Given this, we can now explicitly describe the ramification divisor
\[
R = \sum_{i=1}^d 2n_i[P_i] - 2(g+1-d)[P_\infty].
\]
\todo{reference}

We now compute the basis of $H^1(X,\cO_X)$, before explicitly stating the basis of $\derhamone$.\\
\todo[inline]{not edited, since may use different proof}
\begin{lem}\label{basish1}
 
 The elements $\frac{y}{x}, \ldots , \frac{y}{x^g}$ form a basis of $H^1(X,\cO_X)$.
 
\end{lem}
\begin{proof}
 
We prove this directly by \cech cohomology.
By Leray's theorem \todo{citation} we know that $H^1(X,\cO_X) \cong \check{H}^1(\cU,\cO_X)$.
The \cech complex is as follows:
\begin{equation*}
0 \rightarrow \cO_X(U_1) \times \cO_X(U_2) \xrightarrow{d_0} \cO_X(U_1 \cap U_2) \xrightarrow{d_1} 0.
\end{equation*}

So we wish to show that when $1 \leq i \leq g$ the elements $x^{-i}y$ form a basis of 
\begin{equation*}
\frac{\ker (d_1)}{\Ima (d_0)} = \frac{ \cO_X(U_1 \cap U_2)}{\Ima (d_1)}.
\end{equation*}


We first compute the divisor of $x^{-i}y$ in order to check that it is indeed regular on $U_1 \cap U_2$.

When $p \neq 2$ then
\begin{align*}
    \di(x^{-i}y) & = \di(y) - \di(x^i) \\
    & = R - 2(g+1)[P_\infty] - 2i[P_0] + 2i[P_\infty] \\
    & = (R - [P_0] - [P_\infty]) -(2i-1)[P_0] - (2g +1 -2i)[P_\infty].
\end{align*}

On the other hand, if $p =2$ then 
\begin{align*}
    \di(x^{-i}y) & = \di(y) - \di(x^i) \\
    & = \di_0(y) - (2g+1)[P_0] -2i[P_0] + 2i[P_\infty] \\
    & = \di_0(y) -2i[P_0] - ( 2g + 1 -2i).
\end{align*}
So we see that, regardless of characteristic, the only poles are at $P_0$ and $P_\infty$, and hence $x^{-i}y \in \cO_X(U_1 \cap U_2)$.

It remains to show that the elements are not in the image of $d_0$ and hence are non-zero in the first cohomology group.

We  fix $i \in \{1, \ldots, g\}$ and suppose that there exists $f_1 \in \cO_X(U_1)$ and $f_2 \in \cO_X(U_2)$ such that their difference is $x^{-i}y$.


If $p \neq 2$ then $f_1$ necessarily has a pole of order $1-2i$ at $P_0$.
We write $f_1$ as $y \frac{p(x)}{q(x)}$, where $p(x)$ and $q(x)$ have no common factor.
Note that we require a $y$ term since we have an odd order at $P_0$, and since $y^2$ is a function of $x$, we can assume that the power of $y$ is just 1.
We also require $q(x)$ has a factor of $x^i$, and we let $q'(x) : = \frac{q(x)}{x^i}$.
In order for this function to be in $\cO_X(U_1)$ we require that $\frac{p(x)}{q'(x)}$ of order at least $2i-2g-1$ at $P_\infty$, else we will have a pole at $P_\infty$.
This is only possible if $\frac{p(x)}{q(x)}$ has a pole or poles at points other than $P_0$ and $P_\infty$, since $\deg(\di(f_1)) = 0$.
The only zeroes of our function so far are at the ramification points, so clearly the poles of $\frac{p(x)}{q'(x)}$ must be at the ramification points too.
Since $p$ and $q'$ are functions of $x$ any pole at a ramification point must be of even order; in particular they must be at least order 2.
Since we have the zeroes at the ramification points of $y$ and $x^i$ are exactly order 1 (except at the points $P_0$ and $P_\infty$, which we are not considering), this contradicts $f_1$ being regular on $U_1$.

Hence such an $f_1$ cannot exist, and the image of $x^{-i}y$ in $\check{H}^1(\cU,\cO_X)$ is non-zero (for all $i$).


If $p=2$ then we use a similar proof, but 
\end{proof}


In order to state the basis of $\derhamone$, as well as to shorten the proof of the following proposition, we define the following polynomial and differentials.\todo{change all de rham cohomology symbols}
Suppose that $1 \leq i \leq g$
Firstly, when $p\neq 2$ we define
\[
s_i(x) := f'(x) - \frac{2if(x)}{x} \in k[x]
\]
and if $p = 2$ we define
\[
S_i(x,y) := xF'(x) + xyH'(x) + iyH(x)\in k[x]\oplus yk[x] \subseteq k(x,y).
\]

We now decompose these polynomials in to two parts, which will be used in the sequel.
Firstly, we write $s_i(x)$ as $s_i(x) = \phi_i(x) + \psi_i(x)$, where $\psi_i(x)$  and $\phi_i(x)$ are the unique polynomials in $k[x]$ such that $\deg(\phi_i (x)) \leq g$ and $x^{g+1}$ divides $\psi_i(x)$.
Similarly, we write $S_i(x,y)$ as $S_i(x,y) = \Phi_i(x,y) + \Psi_i(x,y)$, where $\Phi_i(x,y), \Psi_i(x,y) \in k[x,y]$ are the unique polynomials such that the degree of $\Psi_i(x,y)$ has degree less than $i$ as a polynomial in $x$, and $\Phi_i(x,y)$ is divisible by $x^i$.

Viewing $\derhamone$ as a quotient of \eqref{derhamconditions}, we now give a $k$-vector space basis of the space.

\begin{thm}\label{basis}

If $p \neq 2$ then the residue classes of the elements 
\begin{equation}\label{one}
 \left( \left( \frac{-\psi_i(x)}{2yx^i}\right) dx, \left(\frac{\phi_i(x)}{2yx^i}\right) dx, x^{-i}y\right), i=1, \ldots ,g,
\end{equation}
along with the residue classes of 
\begin{equation}\label{two}
 \left( \frac{x^{i}}{y} dx , \frac{x^{i}}{y} dx, 0 \right), i = 0,\ldots ,g-1,
\end{equation}
form a basis of $\derhamone$.

On the other hand, if $p=2$ then the residue classes of the elements 
\begin{equation}\label{three}
\left( \left(\frac{-\Psi_i(x,y)}{x^{i+1}H(x)}\right) dx, \left( \frac{\Phi_i(x,y)}{x^{i+1}H(x)} \right) dx, x^{-i}y \right), i =1, \ldots , g, 
\end{equation}
together with the residue classes of 
\begin{equation}\label{four}
 \left( \frac{x^{i}}{H(x)} dx, \frac{x^{i}}{H(x)} dx, 0 \right), i=0, \ldots, g-1,
\end{equation}
form a basis of $\derhamone$.

\todo[inline]{check if the minus signs are the right way round, and that the elements are the right way round.}
\end{thm}

Before proving this proposition we use it to prove our main theorem\\


\begin{cor}

If $G$ acts faithfully on $X$ also acts faithfully on $\cechhone$.
\todo[inline]{how should G act}

\end{cor}
\begin{proof}

Recall that $H^0(X,\Omega_X)$ injects in to $\derhamone$.
Then if $p \neq 2$, or if $G$ does not contain a hyperelliptic involution, it follows from the main theorem of \cite{faithfulaction} that $G$ acts faithfully on $H^0(X,\Omega_X)$, and hence $G$ acts faithfully on $\derhamone$.

We now suppose that $p=2$ and $G$ does contain a hyperelliptic involution $\sigma$.
We see from the above theorem that the third entry in part \eqref{three} of the basis of $\derhamone$ given by \cech cohomology is $x^{-i}y$ for $1 \leq i \leq g$.
Now $\sigma(y) = y+ H$, and $\sigma$ preserves the cover $\mathcal U$, since it will fix the ramification points.
Hence the action of $\sigma$ on the basis elements in Proposition \ref{basis} is just component wise, and in particular on the third component it is non-trivial.
Hence the action of $G$ is faithful.
\todo[inline]{correct proof}
\todo[inline]{check the last paragraph. In particular, read up about actions on Cech cohomology}

\end{proof}

\todo[inline]{look up classes of hyperelliptic curves whose auto groups are known, and see what else can be done}

We now prove Theorem \ref{basis}.

\begin{proof}
We make use of the fact that the short exact sequence \eqref{ses} splits as a sequence of vector spaces over $k$, and that we know bases of the outer two terms.

It is clear that \eqref{two} and \eqref{four} is an element of \eqref{derhamconditions}, and it follows from \cite[Thm 6.1]{faithfulaction} that they are the image of the basis of $H^0(X,\Omega_X)$ in $\cechhone$.\todo{more accurate citation}

Moreover it is obvious that the elements \eqref{one} and \eqref{three} map to the basis of $\hone$ give in Lemma \cite{basish1} if they belong to \eqref{derhamconditions}.
So it only remains to show that the first two terms in \eqref{one} and \eqref{three} belong to \eqref{derhamconditions}.


We start with the case $p\neq 2$, and observe that
\begin{align*}
\left(  \frac{\psi_i(x)}{2yx^i}  - \frac{-\phi_i(x)}{2yx^i} \right) dx & =  \frac{s_i(x)}{2yx^i} dx \\
& =  \frac{1}{2yx^i} \left( f' - \frac{2if}{x} \right) dx \\
& =  \frac{x^i}{2y} \left( \frac{f'}{x^{2i}}dx -\frac{2if}{x^{2i+1}} dx \right) \\
& =  \frac{x^i}{2y} \left( fd(\frac{1}{x^{2i}}) + \frac{1}{x^{2i}}df \right) \\
& =  \frac{x^i}{2y}d(fx^{-2i}) \\
& =  \frac{x^i}{2y} d\left(yx^{-i}\right)^2 \\
& =  d(yx^{-i}).
\end{align*}
\todo[inline]{explain penultimate line}
This shows that the elements in \eqref{one} satisfy \eqref{derhamconditions}
Hence it only remains to show that $\frac{\phi_i}{2yx^i}dx$ and $\frac{-\psi_i}{2yx^i}dx$ are regular on $U_1$ and $U_2$ respectively.



We define $\alpha^i_j \in k$ for $0\leq j \leq 2g$ by the equation
\[
s_i(x) = \alpha^i_{2g}x^{2g} + \ldots + \alpha^i_0,
\]
so that
\[
\phi_i(x) = \alpha^i_{2g}x^{2g} + \ldots + \alpha^i_{g+1}x^{g+1} \ {\rm and } \ \psi_i(x) = \alpha^i_gx^g + \ldots + \alpha^i_0.
\]
Note that it is possible for any of $\alpha_i^j$ to be zero. Indeed, it is possible for either $\phi_i$ or $\psi_i$ to be zero.
Whenever they are non-zero we denote their degrees as polynomials in $x$ by $d_\phi$ and $d_\psi$ respectively. From the definition of $\phi$ and $\psi$ we know that $0 < d_\psi \leq g$ and $g < d_\phi \leq 2g$ respectively.
Note that we have suppressed the $i$ index here since this will be clear from context.
\todo[inline]{remove d psi, remove last line?}


We now show that $\frac{\phi_i}{2yx^i}dx$ and $\frac{\psi_i}{2yx^i}dx$ are regular on $U_2$ and $U_1$ respectively.
We may assume that $\phi_i$ and $\psi_i$ are non-zero, since zero is regular everywhere.
The divisor of $\frac{-\phi_i}{2yx^i}dx$ is

\begin{align*}
\di\left( \frac{-\phi_i}{2yx^i}dx \right) & =  \di(\phi_i) -\di(y) - \di(x^i) + \di (dx) \\
& =  \di(\phi_i) - ( R - 2(g+1)[P_\infty]) - (2i[P_0] - 2i[P_\infty]) + (R - 4[P_\infty]) \\
& =  \left( \di_0\left( \frac{\phi_i}{x^{g+1}}\right) + 2(g+1)[P_0] - 2d_\phi[P_\infty]\right) - 2i[P_0] + 2(g+i-1)[P_\infty] \\
& \geq  \di_0\left( \frac{\phi_i}{x^{g+1}}\right) + 2(g+1)[P_0] - 4g[P_\infty] - 2i[P_0] + 2(g+i-1)[P_\infty] \\
& =  \di_0\left( \frac{\phi_i}{x^{g+1}} \right) + 2(i-g-1)[P_\infty] + 2(g-i+1)[P_0].
\end{align*}
which shows that it is regular on $U_2 = X\backslash \{P_\infty\}$, since $i \leq g$.
\todo[inline]{cite divisors used}

Similarly the divisor of $\frac{\psi_i}{2yx^i}dx$ is

\begin{align*}
\di \left( \frac{\psi_i}{2yx^i}dx\right) & =  \di(\psi_i) - \di(y) - \di(x^i) + \di (dx) \\
& =  \di (\psi_i ) -(R - 2(g+1)[P_\infty]) - (2i[P_0] - 2i[P_\infty]) + (R -4[P_\infty]) \\
& =  \di(\psi_i) + 2(g+i-1)[P_\infty] -2i[P_0] \\
& \geq \left( \di_0(\psi_i) - 2g[P_\infty] \right) + 2(g+i-1)[P_\infty] -2i[P_0] \\
& =  \di_0(\psi_i) + 2(i-1)[P_\infty] - 2i[P_0].
\end{align*}
Since $i\geq 1$ we conclude that $\frac{\psi_i}{2yx^i}dx$ is regular on $U_1 = X \backslash \{P_0\}$.
\todo[inline]{cite divisors used}


We now consider the case when $p=2$.
We see that
\begin{align*}
\left( \left( \frac{ \Psi_i}{x^{i+1}H} \right) - \left( \frac{\Phi_i}{x^{i+1}H} \right) \right) dx & =  \frac{S_i}{x^{i+1}H}dx \\
& =  \left( \frac{F'}{x^iH} + \frac{yH'}{x^iH} + \frac{iy}{x^{i+1}} \right) dx \\
& =  \frac{1}{x^i}\left( \frac{F' + yH'}{H} \right) dx + \frac{iy}{x^{i+1}}dx \\
& =  x^{-i}dy + yd \left( x^{-i}\right) \\
& =  dyx^{-i}.
\end{align*}
 \todo[inline]{explain penultimate line}
Hence it only remains to show that $\frac{\Phi_i}{x^{i+1}H}dx$ and $\frac{\Psi_i}{x^{i+1}H}dx$ are regular on $U_2$ and $U_1$ respectively.


We define $A^i_{j+1} \in k$ for $0 \leq j \leq 2g$, and $B_k^i \in k$ for $1\leq k \leq g$ by the equation
\[
S_i(x,y) = A_{2g+1}^ix^{2g+1} + \ldots + A^i_1 x + y(B_g^i x^g + \ldots + B_1^i x).
\]
Note that many of these coefficients may be zero.
In particular we note that $B_i^i = 0$ for all $i$.
If $i$ is even then $B_g^ix^g + \ldots + B_1^ix = H'x$.
The differential of a polynomial in characteristic two has no odd powered terms, and hence multiplying by $x$ leaves no even terms.
Since we supposed that $i$ is even this means that $B_i^i = 0$.

Similarly, if $i$ is odd then $B_g^ix^g + \ldots + B_1^ix = H'x + H$.
Since, as just discussed, $H'x$ has all the odd terms of $H$, it follows that when we $H$ all the odd coefficients are now zero, whilst the even ones remain.
So in this case we again see that $B_i^i = 0$.
\todo[inline]{simplify two paras above}


We can now define the following polynomials:
\begin{align*}
\Phi_i^x & = & A^i_{2g+1}x^{2g+1} + \ldots + A^i_{i+1}x^{i+1} \\
\Psi_i^x & = & A^i_ix^i + \ldots + A^i_1x \\
\Phi_i^y & = & B_g^ix^g + \ldots B_{i+1}^ix^{i+1} \\
\Psi_i^y & = & B_{i-1}^ix^{i-1} + \ldots + B_1^ix.
\end{align*}

We denote the degrees of these polynomials by $d_{\Phi}^x, d_{\Psi}^x, d_{\Phi}^y$ and $d_{\Psi}^y$ respectively.

Clearly $\Phi_i = \Phi_i^x + y\Phi_i^y$ and $\Psi_i = \Psi_i^x + y\Psi_i^y$, and we will use these splittings of to show that $\Phi_i$ and $\Psi_i$ are regular on $U_2$ and $U_1$ respectively.
\todo[inline]{compute divisor of dx/xi+1H first?}

We first compute the divisors associated to $\Phi_i$.
Firstly,
\begin{align*}
\di \left( \frac{\Phi_i^x dx}{x^{i+1} H} \right)  = &  \di(\Phi_i^x) + (R - 4[P_\infty]) - (2(i+1)[P_0] - 2(i+1)[P_\infty])\\
& - (R - (2g+2) [P_\infty]) \\
 = & \left( \di_0(\Phi_i^x) -d_\Phi^x[P_\infty]\right) -2(i+1)[P_0] + 2(g+i)[P_\infty]\\
 \geq & \di_0(\Phi_i^x) - 2(2g+1)[P_\infty] - 2(i+1)[P_0] + 2(g+i)[P_\infty] \\
 = &  \di_0(\Phi_i^x) - 2(i+1)[P_0] + 2(i-1-g)[P_\infty] \\
 =  & \di_0 \left( \frac{\Phi_i^x}{x^{i+1}} \right) + 2(i-g-1)[P_\infty],
\end{align*}
\todo[inline]{define superscript x notation and cite divisors uses}
which is clearly positive on $U_2 = X \backslash \{P_\infty\}$.

We now compute the divisor of the other half of $\frac{\Phi_i}{x^{i+1}H}dx$, namely
\todo{terms missing in first line?}
\begin{align*}
\di\left(\frac{y\Phi_i^y dx}{x^{i+1}H} \right)  = & (\di_0(y) - (2g+1)[P_\infty]) + \di(\Phi_i^y) + (R - 4[P_\infty])\\
& -(2(i+1)[P_0] - 2(i+1)[P_\infty]) - (R  - (2g+2)[P_\infty]) \\
 = & \di_0(y) + \di(\Phi_i^y) -2(i+1)[P_0] + (2i -1)[P_\infty] \\
 = & \di_0(y) + \di_0(\Phi_i^y) - 2d_\Phi^y[P_\infty] - 2(i+1)[P_0] + (2i-1)[P_\infty] \\
 = & \di_0(y) + \di_0\left(\frac{\Phi_i^y}{x^{i+1}} \right) + (2i-2d_\Phi^y -1)[P_\infty]
\end{align*}
This completes the proof that $\Phi_i$ is regular on $U_2 = X \backslash \{P_0\}$.

We now complete the same computations on $\Psi_i$, starting with $\Psi_i^x$:
\begin{align*}
\di\left( \frac{\Psi_i^x dx}{x^{i+1}H} \right)  = &  \di(\Psi_i^x) + (R - 4[P_\infty]) - (2(i+1)[P_0] - 2(i+1)[P_\infty])\\
&  - (R - 2(g+1)[P_\infty]) \\
 \geq &  \di_0(\Psi_i^x ) - 2i[P_\infty] - 2(i+1)[P_0] + 2(g+i)[P_\infty] \\
 = &  \di_0(\Psi_i^x) - 2i[P_0] + 2(g+1)[P_\infty],
\end{align*}
which is clearly positive on $U_1$.

\begin{align*}
\di\left(\frac{y\Psi_i^y dx}{x^{i+1}H} \right)  =  & \di_0(y) - (2g+1)[P_\infty] + \di(\Psi_i^y) + R - 4[P_\infty] -2(i+1)[P_0] \\ 
& + 2(i+1)[P_\infty] - R + (2g+2)[P_\infty] \\
 =  & \di_0(y) + \di(\Psi_i^y) -2(i+1)[P_0] + (2i -1)[P_\infty] \\
 = &  \di_0(y) + \di_0(\Psi_i^y) - 2d_\Psi^y[P_\infty] - 2(i+1)[P_0] + (2i-1)[P_\infty] \\
 \geq &  \di_0(y) + \di_0(\Psi_i^y) -2(i-1)[P_\infty] -2(i+1)[P_0] + (2i-1)[P_\infty] \\
 =   &\di_0(y) + \di_0(\Psi_i^y) -2(i+1)[P_0] + [P_\infty].
\end{align*}




Again, it is clear that this differential is regular on $U_1$, and we have completed the proof.



\end{proof}

\section{Computing the residue}

We include the following lemma for the sake of completeness.

\begin{lem}
If $p \neq 2$ then ${\rm res}_{P_\infty}(\frac{1}{x}dx) = -2$.
If $p=2$ then ${\rm res}_{P_\infty}\left(\frac{ydx}{xh(x)}\right) = 1$.
\end{lem}

\begin{proof}

We first consider the case $p\neq 2$.
To start with we note that $t:= \frac{y}{x^{g+1}}$ is a uniformising parameter at $P_\infty$.
Indeed we can compute the order of $t$ at $P_\infty$ as follows
\begin{eqnarray}
\ord_{P_\infty}(t) & = & \frac{1}{2}\ord_{P_\infty}(t^2) \\
  & = & \frac{1}{2}\ord_{P_\infty}\left( \frac{f}{x^{2g+2}} \right) \\
& = & \frac{1}{2}\ord_{P_\infty}(f(x)) - \frac{1}{2}\ord_{P_\infty}(x^{2g+2})\\
& = & -(2g+1) + (2g+2) \\
& = & 1.
\end{eqnarray}

We now write $\frac{1}{x}dx$ in terms of $dt$.
By the quotient rule we know that
\begin{eqnarray*}
dt^2 & = & d \left( \frac{f(x)}{x^{2g+2}} \right) \\
& = & \frac{x^{2g+2}f' + x^{2g+1}f}{x^{4g+4}} dx \\
& = & \frac{1}{x^{2g+2}} \left( f' + \frac{f}{x} \right) dx
\end{eqnarray*}
and it then follows that
\[
\frac{1}{x}dx = \frac{-2tx^{2g+1}}{\left(\frac{(2g+2)f}{x} - f'\right)} dt.
\]


We now let $h = \left(\frac{(2g+2)f}{x} - f'\right)$, and noting that the coefficient of $x^{2g}$ in $h$ is $(2g+2)a_{2g+1} - (2g+1)a_{2g+1} = a_{2g+1}$, we see that $h$ is a degree $2g$ polynomial in $x$.
We wish to compute the coefficient of $t^{-1}$ in the expansion of $\frac{1}{x}dx$ at $P_\infty$ and computing the first coefficient of $\frac{h}{x^{2g+1}}$ is a key step.

Now
\[
\frac{h}{x^{2g+1}} = \frac{a_{2g+1}x^{2g}}{x^{2g+1}} + \ldots = \frac{a_{2g+1}}{x} + \ldots
\]
Similarly
\[
t^2 = \frac{f}{x^{2g+2} } = \frac{a_{2g+1}}{x} + \ldots
\]

Since $\ord_{P_\infty}\left(\frac{h}{x^{2g+1}}\right) = 2$ we know that $\frac{h}{x^{2g+1}} = \sum_{j\geq 2} c_j t^j$ for some $c_j\in k$, and from the above computations we can see that $c_2 = 1$.
We also know that $\frac{x^{2g+1}}{h} = \sum_{k\geq -2} d_kt^k$, for some $d_k\in k$, and clearly $d_{-2} = 1$.
Now
\[
\frac{1}{x}dx = \left( -2t \cdot \sum_{i\geq -2} d_it^i\right) dt 
\]
so we see that the residue is $-2$.
This complets the proof of the lemma when $p\neq 2$.

We now turn to the case when $p=2$.
We now wish to compute the residue of $\frac{ydx}{xH(x)}$ at $P_\infty$.
We start by noting that $t = \frac{y}{x^{g+1}}$ is a uniformising parameter at $P_\infty$; we check this by computing the divisor:
\[
\di(t) = \di_0(y) - (2g+1)[P_\infty] -(2g+2)[P_0] + (2g+2)[P_\infty] = \di_0(y)-(2g+2)[P_0] + [P_\infty].
\]

So clearly $t$ is a uniformising parameter at $P_\infty$.

We now wish to write $\frac{y}{xH(x)}dx$ as $r(x,y)dt$ for some $r \in k(x,y)$.
We first write $dy$ in terms of $dx$.
Since
\begin{eqnarray*}
0 & = & dy^2 \\
& = & d(F+yH) \\
& = & F'dx + Hdy + yH'dx
\end{eqnarray*}
we conclude that
\[
dy = \left( \frac{F'+yH'}{H} \right) dx.
\]
We now rewrite $dt$ as follows:
\begin{eqnarray*}
dt & = & d\left( \frac{y}{x^{g+1}} \right) \\
& = & yd\frac{1}{x^{g+1}} + \frac{1}{x^{g+1}}dy \\
& = & \frac{1}{x^{g+1}} \left( \frac{(g+1)y}{x} + \frac{F'+yH'}{H} \right) dx \\
& = & \frac{1}{x^{g+1}} \left( \frac{xF'}{y} + xH' + (g+1)H \right) \frac{y}{Hx} dx.
\end{eqnarray*}

In total we then have
\[
\frac{y}{xH(x)}dx = \frac{x^{g+1}y}{S_{g+1}(x,y)}dt
\]
where $S_{g+1}(x,y) = xF' + yxH' + (g+1)yH$.

We know that $\frac{x^{g+1}y}{S_{g+1}(x,y)} = \sum_{i\geq -1} c_i t^i$, with $c_i \in k$, and we wish to compute $c_{-1}$.


We shall do this by computing the coefficient of $t$ in the expansion $\frac{S_{g+1}(x,y)}{x^{g+1}y} = \sum_{i\geq 1}d_it^i$.
We can split up $\frac{S_{g+1}(x,y)}{x^{g+1}y}$ in to three terms, namely $\frac{xF'}{x^{g+1}y}$, $\frac{yxH'}{x^{g+1}y}$ and $\frac{yH}{x^{g+1}y}$.
Each of these terms can of course be written as a power series in $t$, but only the first term mentioned has order 1 at $P_\infty$, and hence this term will uniquely determine $d_1$.
Suppose that $F = \alpha_{2g+1}x^{2g+1} + \alpha_{2g}x^{2g} + \ldots + \alpha_1x^1 + \alpha_0$.
Then $xF'= \alpha_{2g+1}x^{2g+1} + \alpha_{2g-1}x^{2g-1} + \ldots + \alpha_1x^1$; i.e. the terms with an even power are removed.

So the only term in $\frac{xF'}{x^{g+1}y}$ of order 1 at $P_\infty$ is $\frac{\alpha_{2g+1}x^{2g+1}}{x^{g+1}y} = \frac{\alpha_{2g+1}x^{g}}{y}$.
Since
\[
\frac{\alpha_{2g+1}x^g}{y} = \frac{\alpha_{2g+1}}{x}t^{-1}
\]
and $\frac{1}{x} = \sum_{i\geq 2}e_it^i$ for some $e_i \in k$, if we compute $e_2$ then we will have effectively computed $d_1$.
Now $t^2 = \frac{F }{x^{2g+2}}+ \frac{Hy}{x^{2g+2}}$, and clearly $\frac{Hy}{x^{2g+2}}$ has no terms of the form $\frac{c}{x}$ for some $c \in k$.
On the other hand
\[
\frac{F}{x^{2g+2}} = \frac{\alpha_{2g+1}}{x} + \ldots
\]
Hence we conclude that $e_2 = \frac{1}{\alpha_{2g+1}}$.
It follows that $d_1 = \alpha_{2g+1} \cdot \frac{1}{\alpha_{2g+1}} = 1$.


We finally use this to compute $c_{-1}$.
Since $1 = \frac{S_{g+1}(x,y)}{x^{g+1}y}\cdot \frac{x^{g+1}y}{S_{g+1}(x,y)} = \left( \sum_{i\geq 1}d_it^i \right) \cdot \left( \sum_{i\geq -1}c_it^i\right)$, we conclude that $c_{-1} = \frac{1}{d_{1}} = 1$.

\todo{clean up this last section}



\end{proof}



\begin{comment}
We define $\alpha^i_j$ and $\Alpha^i_{j+1}$ for $0 \leq j \leq 2g$, and $B_k^i$ for $1\leq k \leq g$, such that
\[
$s_i(x) = \alpha^i_{2g}x^{2g} + \ldots + \alpha^i_0 \ {\rm and } \ S_i(x) = A_{2g+1}^ix^{2g+1} + \ldots + A^i_1 x + y(B_g^i x^i + \ldots + B_1^i x).
\]
\end{comment}




\bibliography{biblio}
\bibliographystyle{plain}


\end{document}
