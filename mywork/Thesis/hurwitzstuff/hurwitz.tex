\chapter{The Riemann-Hurwitz formula} \label{Chapter:hurwitzformula}

\todo[inline]{Use "T" as a variable for polynomials throughout chapter}

Let $X$ and $Y$ be two projective, non-singular curves over an algebraically closed field $k$, with a map $\pi \colon X \rightarrow Y$ of degree $n$.
We let $g_X$ and $g_Y$ be the genera of $X$ and $Y$ respectively.
Let $K(X)$ and $K(Y)$ be the function fields of $X$ and $Y$ respectively.
Note that $K(X)$ is a degree $n$ extension of $K(Y)$, and recall that $\pi$ induces a map $\pi^*\colon K(Y) \rightarrow K(X)$.
As usual, for any $P \in X$ and $Q \in Y$ we denote the local ring formed by functions which are regular at $P$ and $Q$ by $\cO_{X,P}$ and $\cO_{X,Q}$ respectively.

\section{Galois Theory}\label{sectiongaloistheory}
    
We recall some facts from Galois theory for a field extension $L/K$ of degree $n$.
Any element $\alpha \in L$ defines a $K$-linear map $\mu_{\alpha} \colon  L \rightarrow L$, given by multiplication by $\alpha$.
We let $\tr_{L/K}(\alpha)$ be the trace of the matrix in $\operatorname{Mat}_{n \times n}(K)$ corresponding to $\mu_\alpha$.
Hence we form the {\em trace map} $\tr_{L/K}\colon L \ra K$.
When considering the trace map between the function fields $K(X)$ and $K(Y)$ we let $\tr_{X/Y} := \tr_{K(X)/K(Y)}$.
Note that $\tr_{L/K}$ is an additive map, and that for $\alpha \in K$ we have $\tr_{L/K}(\alpha) = n \alpha$.
    \begin{prop}\label{proptracelemmasurjective}
    The trace map $\tr_{X/Y} \colon K(X) \ra K(Y)$ is surjective.
    \end{prop}
    \begin{proof}
    We first show the equality 
        \[
        \tr_{\overline{K(Y)}\otimes_{K(Y)}K(X)/\overline{K(Y)}} = \id_{\overline{K(Y)}}\otimes _{K(Y)} \tr_{X/Y} \colon \overline{K(Y)}\otimes_{K(Y)}K(X) \ra \overline{K(Y)},
        \]
    with the latter map given by $f\otimes h \mapsto f\tr_{X/Y}(h)$.
    It then follows that the surjectivity of $\id_{\overline{K(Y)}}\otimes _{K(Y)} \tr_{X/Y}$ and $\tr_{\overline{K(Y)}\otimes_{K(Y)}K(X)/\overline{K(Y)}}$ are equivalent.
    We let $h_1, \ldots, h_n$ be a $K(Y)$ basis of $K(X)$, and write $hh_j = \sum_{i=1}^n c_{ij}h_i$ for $c_{ij} \in K(Y)$.
    Then a $\overline{K(Y)}$-basis of $\overline{K(Y)}\otimes_{K(Y)}K(X)$ is given by $1 \otimes h_1, \ldots, 1 \otimes h_n$, and 
        \[
        (f \otimes h)(1\otimes h_j) = f \otimes hh_j = \sum_{i=1}^n c_{ij}(f \otimes h_i) = \sum_{i=1}^n c_{ij}f(1 \otimes h_i).
        \]  
    Hence the matrix corresponding to $\mu_{f \otimes h}$ is $c_{ij}f$, and so
        \[
        \tr_{\overline{K(Y)}\otimes_{K(Y)}K(X)/\overline{K(Y)}}(f \otimes h) = \sum_{i=1}^n c_{ii}f = f \tr_{X/Y}(h).
        \]  

    We now show that $\tr_{\overline{K(Y)}\otimes_{K(Y)}K(X)/\overline{K(Y)}}$ is surjective.
    Since $K(X)$ is a Galois extension of $K(Y)$, and hence also separable, we can find $\alpha$ separable over $K(Y)$ such that $K(X) = K(Y)(\alpha)$.
    We suppose that $\alpha$ has minimal (separable) polynomial ${f(z) = (z - \beta_1)\cdots (z - \beta_n)}$.
    Since
        \[
        K(X) \cong K(Y)(\alpha) \cong K(Y)(z)/(f(z)) \cong \bigoplus_{i=1}^n K(Y)(z)/((z-\beta_i)) \cong \bigoplus_{i=1}^n K(Y)
        \]  
    then $\overline{K(Y)}\otimes_{K(Y)} K(X) \cong \bigoplus_{i=1}^n \overline{K(Y)}$.
    Now $\tr_{\overline{K(Y)}\otimes_{K(Y)}K(X)/\overline{K(Y)}}$ is the sum of the trace map on each component.
    But the trace map $\tr_{\overline{K}/\overline{K}}$ is the identity.
    Hence $\tr_{\overline{K(Y)}\otimes_{K(Y)}K(X)/\overline{K(Y)}}$ is surjective, and so $\tr_{X/Y}$ is too.
    \end{proof}

    \begin{lem} 
    Suppose that $\alpha \in K(X)$ has minimum polynomial 
        \[
        f(x) = x^r + a_{r-1}x^{r-1} + \ldots +a_0 \in K(Y)[x]
        \]
    and $s= [K(X):K(Y)(\alpha)]$, then $\tr_{X/Y}(\alpha) = -sa_{r-1}$.
    \end{lem}
    \begin{proof}
    We first note that since $s = [K(X):K(Y)(\alpha)]$ it suffices to show the equality $\tr_{K(Y)(\alpha)/K(Y)}(\alpha) = -a_{r-1}$.
    The elements $1, \alpha, \ldots, \alpha^{r-1}$ form a $K(Y)$-basis of $K(Y)(\alpha)$.
    If $i \leq r-2$ then $\mu_{\alpha}(\alpha^i) = \alpha^{i+1}$, and hence the corresponding matrix has 1's below the diagonal and zeroes elsewhere on all columns except the final column.
    Since $\mu_{\alpha}(\alpha^{r-1}) = \alpha^r = -a_0 - a_1\alpha - \ldots - a_{r-1}\alpha^{r-1}$ then the final consists of $-a_0, \ldots, a_{r-1}$.
    Hence the only non-zero diagonal entry is $a_{r-1}$.
    \end{proof}

            
Given a basis $\{z_1,\ldots,z_n\}$ of $K(X)$ over $K(Y)$, we now introduce its dual basis with respect to the trace map.
We denote the {\em dual space} of $K(X)$ over $K(Y)$ by 
    \[
    K(X)^*:=\{\lambda \colon K(X) \rightarrow K(Y)| \lambda\ \text{is}\ K(Y)\text{-linear}\}.
    \]
We make $K(X)^*$ in to a one-dimensional $K(X)$-vector space by defining $z \lambda(w):=\lambda(z w)$.
It follows from Proposition \ref{proptracelemmasurjective} that $\tr_{X/Y}$ is non-zero, and hence there exists a unique $z\in K(X)$ for every $\lambda \in K(X)^*$ such that $\lambda = z\cdot \tr_{X/Y}$.
In particular, if we choose $\lambda_j\in K(X)^*$ such that $\lambda_j(z_i) = \delta_{ij}$ (the Kronecker symbol), then there exist $z_j^*$ such that $\lambda_j = z_j^*\cdot \tr_{X/Y}$.
Hence
    \[
    \tr_{X/Y}(z_iz_j^*) = (z_j^*\cdot \tr_{X/Y})(z_i) = \lambda_j(z_i) = \delta_{ij}.
    \]
The elements $z_1^*, \ldots , z_n^*$ form the {\em dual basis} of $z_1, \ldots , z_n$.


\section{Differentials and divisors}

We first introduce differentials in terms of function fields.
An {\em \adele on $X$} is a map $\alpha\colon  X \rightarrow K(X)$ such $\alpha(P) \in \cO_{X,P}$ for nearly all $P \in X$ (\ie all but a finite number of points).
We can represent $\alpha$ by some $(\alpha_P)_{P \in X} \in \prod_{P \in X} K(X)$, where $\alpha_P := \alpha(P)$.
We let the {\em \adele space} of $X$, denoted by $\cA_X$, be the space of all \adeles on $X$.
There is a canonical injection $K(X) \hookrightarrow  \cA_X$, defined by sending $x\in K(X)$ to the \adele $\alpha$ for which $\alpha_P =  x$ at each point $P\in X$.
The elements of $K(X)$ have natural valuations: for each $P\in X$ we choose a uniformising parameter $t\in \cO_{X,P}$, and then there is a unique $n \in \ZZ$ such that $x=ut^n$ for some unit $u\in \cO_{X,P}$.
We then define the valuation of $x$ at $P$ to be $v(x)_P := n$.
We can we can then extend this valuation to elements of $\cA_X$ by defining $v_P(\alpha) := v_P(\alpha_P)$.

Recall that a divisor on $X$ is a finitely supported formal sum over $X$, with coefficients in $\mathbb Z$, which we write as 
    \[
    D = \sum_{P\in X} n_P [P].
    \]
The degree of such a divisor $D$ is 
    \[
    \deg(D) := \sum_{P\in X} n_P.
    \]
We then define the order of $D$ at $P$ to be $v_P(D) := n_P$.

We let $\cD_X$ be the space of divisors of $X$.
Note that for any $x\in K(X)$ we have a naturally associated divisor, which is
    \[
    \di(x) := \sum_{P\in X} v_P(x) [P].
    \]

For any $D\in \cD_X$ we define the {\em \adele space associated to $D$} to be
    \[
    \cA_X(D):=\{\alpha \in \cA_X | v_P(\alpha) \geq -v_P(D)\ \text{for all} \ P\in X\}.
    \]
Then we define a {\em differential} on $X$ to be a $k$-linear map $\omega\colon  \cA_X \rightarrow k$ such that $\omega$ is zero on $\cA_X(D) +K(X) \subset \cA_X$ for some divisor $D\in \cD_X$.
We will denote the {\em space of differentials on $X$} by $\Omega_{K(X)}$.
    
    \begin{prop}
    The space of differentials, $\Omega_{K(X)}$, is a one-dimensional vector space over $K(X)$.
    \end{prop}
    \begin{proof}
    See \cite[Prop. 1.5.9]{stichtenoth}.
    \end{proof}

    \begin{rem}
    The definition of differential given here is particular to functions fields, and does not obviously correspond to the standard definition in algebraic geometry.
    At the end of the section we collect some results showing the correspondence of these definitions with the more classical definitions.
    \end{rem}

For any non-zero $\omega \in \Omega_{K(X)}$ we define
    \[
    M(\omega) := \{ D\in \cD_X | \omega \ \text{is zero on }\ \cA_X(D) + K(X)\}.
    \]

    \begin{lem}\label{lemmamaximaldivisorassociatedtoomega}
    For any non-zero differential $\omega \in \Omega_{K(X)}$ on $X$ there is a divisor $W$ in $M(\omega)$ such that for any $D \in M( \omega)$ then $D \leq W$.
    \end{lem}
    \begin{proof}
    See \cite[Lem. 1.5.10]{stichtenoth}.
    \end{proof}

For any non-zero $\omega \in \Omega_X$ we call the corresponding divisor from Lemma \ref{lemmamaximaldivisorassociatedtoomega} {\em the canonical divisor associated to $\omega$}, and we associate the zero divisor to $0 \in \Omega_X$.
We denote the canonical divisor associated to $\omega$ by $\di(\omega)$.
We call a divisor a {\em canonical divisor} if it is the canonical divisor associated to some $\omega \in \Omega_{K(X)}$.
    
    \begin{lem}
    Given any two non-zero canonical divisors, $W$ and $W'$, there exists an $x\in K(X)$ such that $W = W' + \di(x)$.
    Conversely, if $W$ is a canonical divisor, and $x\in K(X)$, then $W + \di(x)$ is a canonical divisor.
    \end{lem}
    \begin{proof}
    See \cite[Prop. 1.5.13]{stichtenoth}.
    \end{proof}

\todo[inline]{Introduce the idea of "the" canonical divisor $K_X$ here - maybe later? Maybe not at all in this section.}
We define a valuation $v_P$ of $\omega \in \Omega_{K(X)}$ at $P \in X$ via the associated canonical divisor $W$, by letting $v_P(\omega) := v_P(W)$.
We say that $\omega$ has a pole at $P \in X$ if $v_P(\omega) < 0$ and that $\omega$ has a zero at $P \in X$ if $v_P(\omega) >0$.
Then we call a differential $\omega \in \Omega_{K(X)}$ a {\em holomorphic differential} if it is has no poles (\ie if $v_P(\omega) \geq 0 $ for every $P \in X$).
We denote {\em the space of holomorphic differentials} by $\hzero$.
Also, for any divisor $D$ on $X$ we define 
    \[
    H^0(X,\cO(D)) := \{x\in K(X) | v_P(x) \geq -v_P(D)\}\cup \{0\}.
    \]\todo{change this notation to Fulton's or Stichtenoth's}
This is sheaf theoretic notation, which would not normally be used in function field theory, but we use it for consistency with the rest of the report.\todo{change this sentence after changing notation}
We can now state the celebrated Riemann-Roch theorem.

    \begin{thm}[Riemann-Roch Theorem]\label{theoremriemannroch}
    Let $W$ be a canonical divisor on $X$.
    Then for any divisor $D$ on $X$ 
        \[
        \dim H^0(X,\cO(D)) = \deg(D) + 1 - g_X + \dim H^0(X,\cO(W-D)).
        \]
    \end{thm}
    \begin{proof}
    See, for example, \cite[8.6]{fulton} or \cite[Thm. 1.5.15]{stichtenoth}.
    \end{proof}


    \begin{cor}\label{dim=gc}
    For any canonical divisor $W$ on $X$, we have 
        \[
        \deg(W) = 2g_X-2
        \]
    and 
        \[
        \dim H^0(X,\cO(W)) = g_X.
        \]
    \end{cor}
    \begin{proof}
    Since $\dim H^0(X,\cO(0)) = 1$ (recall that the only functions with no poles are the constant functions), we have by the Riemann-Roch Theorem, 
        \[
        1= \dim H^0(X,\cO(0)) = 0 + 1 -g_X + \dim H^0(X,\cO(W)).
        \]
    Rearranging this gives the second statement.
    The first statement then follows by rearranging
        \[
        g_X = \dim H^0(X,\cO(W)) = \deg(W) + 1 -g_X +  \dim H^0(X,\cO(W-W))= \deg(W) + 1 -g_X + 1.
        \]
    \end{proof}


Given a point $P\in X$ we define $\iota_P\colon K(X) \rightarrow \cA_X$ by
    \begin{equation}
    (\iota_P(x))_Q:= 
        \begin{cases}
        x & \text{if }\ P=Q\\
        0 & \text{otherwise},
        \end{cases}
    \end{equation}
for each $Q\in X$.
We then define $\omega_P\colon K(X) \rightarrow k$ to be the map $\omega_P(x) := \omega(\iota_P(x))$, for $\omega \in \Omega_{K(X)}$.
This is called the {\em local component} of $\omega$; we will use these definitions to prove the following proposition.\todo{change this sentence}

    \begin{prop}\label{propertyofomega}
    Let $\omega$ be a non-zero differential on $X$ and let $P\in X$. Then
        \[
        v_P(\omega) = \max \{r\in \mathbb{Z}|\omega_P(x) = 0\ \text{for all} \ x\in K(X) \ \text{with}\ v_P(x) \geq -r\}.
        \]
    In particular $\omega_P \neq 0$.\todo{make clear that the maximum exists and hence that this is well defined}
    \end{prop}
    \begin{proof}
    Let $W$ be the divisor associated to $\omega$.
    Let $s:=v_P(\omega)$ be the order of $\omega$ at $P$.
    If $x\in K(X)$ and $v_P(x)\geq -s$, then $\iota_P(x) \in \cA_X(W)$, by definition (recall that $0 \in \cA(D)$ for all divisors $D \in \cD_X$).
    Hence $\omega_P(x) = 0$.
    On the other hand, suppose $\omega_P(x) = 0$ for any $x\in K(X)$ satisfying that $v_P(x) \geq -s-1$.
    Let $\alpha = (\alpha_P)_{P \in X} \in \cA_X(W+[P])$.
    Then we have
        \[
        \alpha = (\alpha-\iota_P(\alpha_P)) + \iota_P(\alpha_P).
        \]
    Note that $\alpha - \iota_P(\alpha_P)\in \cA_X(W)$ and $v_P(\alpha_P) \geq -s-1$.
    Hence
        \[
        \omega(\alpha) = \omega(\alpha-\iota_P(\alpha_P))  + \omega_P(\alpha_P) = 0,
        \]
    and so $\omega$ is zero on $\cA_X(W+P)$.
    But this contradicts the maximality of $W$ in its definition.
    \end{proof}

\section{The complementary module}


We now prove some results giving algebraic relations between $K(X)$ and $K(Y)$.
Recall that if $S$ is a subring of $R$, then an element $x\in R$ is {\em integral over $S$} if there is a monic polynomial with coefficients in $S$ for which $x$ is a solution.
Then an {\em integral basis of $R$ over $S$} is a basis of $R$ over $S$, for which each basis elements is integral.
Furthermore, we say that $S$ is integrally closed in $R$ if any element of $R$ which is integral over $S$ lies in $S$.
Recall that $\cO_{X,P}$ is an integrally closed subring of $K(X)$ for any $P\in X$, and that $K(X)$ is the field of fractions of $\cO_{X,P}$.


    \begin{prop}
    For $z\in K(X)$ we let $\phi(T)\in K(Y)[T]$ be its minimal monic polynomial over $K(Y)$.
    Then $z$ is integral over $\cO_{Y,Q}$ if and only $\phi (T)\in \cO_{Y,Q}[T]$.
    \end{prop}
    \begin{proof}
    By definition $\phi(T)$ is the monic irreducible polynomial in $K(Y)[T]$ such that $\phi(z) = 0$. 
    Hence if $\phi (T)$ has coefficients in $\cO_{Y,Q}$ it follows that $z$ is integral over $\cO_{Y,Q}$ by definition.
    
    We now suppose that $z\in K(X)$ is integral over $\cO_{Y,Q}$.
    Then we can choose some monic polynomial $f(T)\in \cO_{Y,Q}[T] \subset K(Y)[T]$ such that $f(z) = 0$.
    Since $\phi(T)$ is minimal over $K(Y)$, then there exists some $\psi(T)\in K(Y)[T]$ such that $ f(T) = \phi(T)\cdot \psi(T)$.\todo{Could add proof of this - consider factorisation in the $K(X)$ adjoin the roots}
    We suppose that $\deg(\phi(T)) = m$ and fix $\alpha_i \in \overline{K(X)}$ such that $\phi(T)$ factorises as 
        \[  
        \phi(T) = (T-\alpha_1)\cdots (T-\alpha_m).
        \]
    We then let $F := K(X)(\alpha_1, \ldots, \alpha_m)$ be a finite extension of $K(X)$, and let $R$ be the integral closure of $\cO_{X,Q}$ in $F$.
    Now the roots of $f(T)$ are in $R$ by definition; in particular, we have $\alpha_1, \ldots, \alpha_m \in R$.
    The coefficients of $\phi(T)$ can be written as polynomials of $\alpha_1, \ldots, \alpha_m$, and hence $\phi(T) \in R[T]$.
    Since $R$ integrally closed $K(Y)\cap R = \cO_{Y,Q}$, and hence $\phi(T)\in \cO_{Y,Q}[T]$.
    \end{proof}

    \begin{cor}\label{traceinclosure}
    Let $Q$ be a point in $Y$ and let $x\in K(X)$ be integral over $\cO_{X,Q}$.
    Then $\tr_{X/Y}(x)\in \cO_{Y,Q}$.
    \end{cor}
    \begin{proof}
    As noted earlier, if $\phi(T)=T^r+a_{r-1}T^{r-1} + \ldots + a_0\in K(Y)[T]$ is the minimal polynomial of $x$ over $K(Y)$, then $\tr_{X/Y}(x)=-n_xa_{r-1}$, where $n_x : = [K(X):K(Y)(x)]$.
    Hence the corollary follows from the previous proposition.
    \end{proof}


We wish to define the ramification divisor, as this is essential for the statement of the Riemann-Hurwitz formula.
In order to do this we first define the complementary module and the ramification index.


    \begin{defn}\label{definitionramificationdivisor}
    Consider a point $P\in X$ in the pre-image of $Q\in Y$ under $\pi$.
    By \cite[Prop. 3.1.4]{stichtenoth} there is an integer $e_P$ such that for any $x\in K(Y)$ the equality $v_P(x) = e_P\cdot v_Q(x)$ holds.
    This value is called the ramification index of $P$.
    If $e_P>1$ then we say that $\pi$ is ramified at $P$.
    \end{defn}

Given this we can associate to each $Q\in Y$ the divisor
    \[
    \pi^*([Q]) := \sum_{P\mapsto Q} e_P [P].
    \]
This can then be extended from a single point to a divisor on $Y$, in which case for a divisor $D = \sum_{Q\in Y}n_Q [Q]$ we have
    \[
    \pi^*(D) := \sum_{Q\in Y}n_Q \pi^*([Q]).
    \]

    \begin{rem}
    It should be noted that in the literature regarding function field theory, what we have denoted by $\pi^*(D)$ is normally called the conorm of $D$ and is denoted $\operatorname{Con}_{X/Y}(D)$. 
    We used the notation above, from algebraic geometry, to be consistent with the rest of the thesis.
    \end{rem}

    For any $Q\in Y$ we let $\cO_{Y,Q}'$ be the integral closure of $\cO_{Y,Q}$ in $K(X)$.

    \begin{defn}
    For any $Q \in Y$ we define the complementary module over $\cO_{Y,Q}$ to be
        \[
        C_Q :=\{z\in K(X) | \tr_{X/Y}(z\cdot \cO_{Y,Q}') \subseteq \cO_{Y,Q}\}.
        \]\todo{is it okay to say $\tr_{X/Y}(z\cdot \cO_{Y,Q}')$?}
    \end{defn}


The following proposition lists a number of important properties of $C_Q$.

\begin{prop}\label{propfactsaboutc'}
    Fix $Q\in Y$. 
        \begin{enumerate}
        \item $C_Q$ is an $\cO_{Y,Q}'$-module, and $\cO_{Y,Q}' \subseteq C_Q$.
        \item If $z_1,\ldots ,z_n$ is a (necessarily integral) basis of $\cO_{Y,Q}'$ over $\cO_{Y,Q}$, then 
        \[
        C_Q = \sum_{i=1}^n \cO_{Y,Q}\cdot z_i^*,
        \]
        where $z_1^*, \ldots, z_n^*$ is the dual basis of $z_1, \ldots, z_n$.
        \item There is a $t\in K(X)$ such that $C_Q = t\cdot \cO_{Y,Q}'$ (note that $t$ depends on the choice of $Q$).
        Moreover, $v_P(t) \leq 0$ for all $P\in \pi^{-1}(Q)$, and if $t'\in K(X)$ then $C_Q=t'\cdot \cO_{Y,Q}'$ if and only if $v_P(t) = v_P(t')$ for all $P\in \pi^{-1}(Q)$.
        \end{enumerate}
    \end{prop}

However, before we can give a proof of this proposition, we require two lemmata.
% Approximation lemma - page 12 Serre and Thm 1.3.1 Stichtenoth

    \begin{lem}[Approximation lemma]\label{lemmaapproximationlemma}
    Let $m$ be a positive integer. 
    For each $i\in \{1,\ldots, m\}$ let $P_i\in X$, let $\mathcal{P}_i$ be the corresponding maximal ideal of $\cO_{X,P_i}$, let $x_i$ be an element of $K(X)$ and let $r_i$ be an integer.\todo{fix line break}
    Then there is an $x\in K(X)$ such that $v_{P_i}(x-x_i) = r_i$ for all $i$.
    \end{lem}
    
    \begin{rem}
    This result can be strengthened to also say that $v_P(x) \geq 0$ for any $P\notin \{P_1,\ldots ,P_m\}$.\todo{fix line break}
    We will not prove this here, for the sake of brevity, but the proof can be found in \cite[Chap. 1, \S 3, pg. 12]{localfields}.
    \end{rem}
    \todo[inline]{Check proof for consistent notation}

    \begin{proof}
    We first show that there exists an $x$ such that $v_{P_i}(x- x_i) \geq n_i = r_i +1$ for $i \in \{1, \ldots, n\}$.\todo{do we need to define $n_i$ like this or is it clear}
    We let $R:= \cO_{X,P_1} \cap \ldots \cap \cO_{X,P_m}$, and we let $\mathcal{P}_i' := \mathcal{P}_i \cap R$.
    We first prove the lemma assuming that $x_i \in R$.
    We may increase the $n_i$ such that $n_i\geq 0$ for all $i$.
    We may further assume that $x_2 = \ldots = x_m =0$ by linearity.
    Indeed, if we find a function $x_1' \in K(X)$ such that $v_{P_1}(x_1' - x_1) \geq n_1$ and $v_{P_i}(x_1') \geq n_i$ for $i \in \{2, \ldots, m\}$, we can find similar $x_2', \ldots, x_m'$.
    Then the sum $x_1' + \ldots + x_m'$  will satisfy the criteria of the lemma, since
        \[
        v_{P_i}(x_1' + \ldots + x_m' - x_i) \geq \inf\{v_{P_i}(x_1'), \ldots,  v_{P_i}(x_i' - x_i), \ldots, v_{P_m}(x_i)\} \geq n_i
        \]  
    for $i \in \{1, \ldots, m\}$.
    Let $I = {\mathcal{P}_1'}^{n_1} + {\mathcal{P}_2'}^{n_2}\cdots {\mathcal{P}_n'}^{n_m}$.
    This is an ideal of $R$, and since it has elements whose valuation at any $P_i$ is zero, it is in fact equal to $R$.\todo{justify equality}
    Hence we can write $x_1 = x + y$, where $y \in {\mathcal{P}_1'}^{n_1}$ and $x\in {\mathcal{P}_2'}^{n_2}\cdots {\mathcal{P}_n'}^{n_m}$.
    Since $x\in {\mathcal{P}_2'}^{n_2}\cdots {\mathcal{P}_n'}^{n_m}$ it follows that $v_{P_i}(x) \geq n_i$ for $i \in \{2, \ldots, m\}$, and similarly we know $v_{P_1}(x - x_1) = v_{P_1}(y) \geq n_1$.
    Hence satisfies the criteria of the lemma.
    
    In general one can write $x_i = \frac{a_i}{b}$ and $x = \frac{a}{b}$ for $a,a_i\in R$ and $b\in R\backslash \{0\}$.
    Then we require that $v_{P_1}(a-a_i) \geq n_i + v_{P_i}(s)$ for each $i \in \{1, \ldots, m\}$.
    But we can find such an $a \in R$ by the last paragraph.

    We now show that there exists an $x \in K(X)$ such that $v_{P_i}(x - x_i) = r_i$.
    We first choose $z \in K(X)$ such that $v_{P_i}(z - x_i) > r_i$, as above.
    We then choose $z_i \in K(X)$ such that $v_{P_i}(z_i) = r_i$, and pick a corresponding $z' \in K(X)$ such that $v_{P_i}(z - z_i) > r_i$ (again, this can be done by the above argument).
    Then
        \[
        v_{P_i}(z') = v_{P_i}((z'-z_i) + z_i) = \min\{v_{P_i}(z'-z_i),v_{P_i}(z_i)\} = r_i.
        \]
    Finally, if we let $x = z + z'$, then
        \[
        v_{P_i}(x - x_i) = v_{P_i}((z-x_i) + z') = \min\{v_{P_i}(z - x_i), v_{P_i}(z')\} = r_i.
        \]  
    \end{proof}

% Thm 3.2.10 Stichtenoth

    \begin{lem}\label{lemmapidlemma}
    Let $Q\in Y$, and let $\cO_{Y,Q}'$ be the integral closure of $\cO_{Y,Q}$ in $K(X)$.
    Then $\cO_{Y,Q}'$ is a principal ideal domain.
    \end{lem}
    \begin{proof}
    By \cite[Cor. 3.3.5]{stichtenoth}, we have 
        \[
        \cO_{Y,Q}' = \{x\in K(X)|v_P(x) \geq 0 \ \text{for all} \ P\in \pi^{-1}(Q)\}.
        \]  
    Let $I$ be an ideal of $\cO_{Y,Q}'$.
    If we let $\{P_1,\ldots, P_l\} = \pi^{-1}(Q)$ then we can choose $x_i \in I$ for $1\leq i \leq l$ such that $v_{P_i}(x_i) \leq v_{P_i}(y)$ for all $y\in I$.
    By the Approximation Lemma there exist $z_i$ such that $v_P (z_i) = 0$ if $P=P_i$ and $v_{P_j}(z_i) > v_{P_j}(x_j)$ for $j\neq i$.
    Now let $x = \sum_{i=1}^l x_iz_i$ and note that that $v_{P_i}(x) = v_{P_i}(x_i)$ for all $1\leq i\leq l$.
    Then we claim that $I = x \cO_{Y,Q}'$.


    The inclusion $x\cO_{Y,Q}' \subseteq I$ follows immediately from the observation that $x \in I$.
    Now we show that $I \subseteq x\cO_{Y,Q}'$.
    If $y\in I$ then we let $z = x^{-1}y$.
    Then $v_{P_i}(z) = v_{P_i}(y) - v_{P_i}(x_i) \geq 0$ for all $1\leq i\leq l$.
    Hence $z\in \cO_{Y,Q}'$ and so $y = xz \in x\cO_{Y,Q}'$, completing the proof.
    \end{proof}

We now present a proof of Proposition \ref{propfactsaboutc'}.

    \begin{proof}
        \begin{enumerate}
        \item It is clear that $C_Q$ is an $\cO_{Y,Q}'$ module.
        Indeed, if $y\in \cO_{Y,Q}'$, then $y\cdot \cO_{Y,Q}' \subseteq \cO_{Y,Q}'$ and hence $\tr_{X/Y}(z y\cdot \cO_{Y,Q}')\subseteq \tr_{X/Y}(z\cdot \cO_{Y,Q}') \subseteq \cO_{Y,Q}$ for any $z\in C_Q$.
        The fact that $\cO_{Y,Q}'$ is contained in $C_Q$ follows from Corollary \ref{traceinclosure}.
        \item We first show that $C_Q \subseteq \sum_{i=1}^n \cO_{Y,Q}\cdot z_i^*$.
        Suppose $z\in C_Q$.
        Now $\{z_1^*, \ldots ,z_n^*\}$ is a basis of $K(X)$ over $K(Y)$, so there exist $x_1,\ldots , x_n\in K(Y)$ such that $z=\sum_{i=1}^n x_iz_i^*$.\todo{not a basis of $K(X)$ over $K(Y)$, but of the dual space - correct this}
        As $z\in C_Q$ and $z_1,\ldots ,z_n\in \cO_{X,Q}'$, it follows by definition of $C_Q$ that $\tr_{X/Y}(zz_j)\in \cO_{Y,Q}$ for $j\in \{1,\ldots ,n\}$.
        We know that 
            \[
            \tr_{X/Y}(zz_j) = \tr_{X/Y}\left(\sum_{i=1}^nx_iz_iz_j^*\right) = \sum_{i=1}^nx_i \cdot \tr_{X/Y}(z_iz_j^*) = x_j,
            \]
        since $z_j^*$ is dual to $z_j$.
        Hence each $x_j$ is in $\cO_{Y,Q}$, and $z\in \sum_{i=1}^n\cO_{Y,Q}\cdot z_i^*$.
        
        Now suppose that $z\in \sum_{i=1}^n\cO_{Y,Q}\cdot z_i^*$ and $u\in \cO_{Y,Q}'$.
        Then we need to show that $\tr_{X/Y}(z u)\in \cO_{Y,Q}$.
        We can find $x_i, y_j\in \cO_{Y,Q}$ such that $z=\sum_{i=1}^n x_iz_i^*$ and $u=\sum_{i=1}^ny_jz_j$.
        Then
            \[
            \tr_{X/Y}(zu) = \tr_{X/Y}\left(\sum_{i,j=1}^n \left(x_iy_jz_i^*z_j\right)\right) = \sum_{i,j=1}^n x_iy_j\cdot \tr_{X/Y}(z_i^*z_j) = \sum_{i=1}^n x_iy_i.
            \]
        Since $\sum_{i=1}^n x_iy_i\in \cO_{Y,Q}$, it follows that $z\in C_Q$.
            
        \item By part 2 we can find $u_i\in K(X)$ such that $C_Q = \sum_{i=1}^n \cO_{Y,Q} \cdot u_i$.\todo{should have "*"s?}
        Choose some $x\in K(Y)$ such that $v_Q(x)\geq 0$ and also $v_Q(x)\geq -v_P(u_i)$ for all $P\in \pi^{-1}(Q)$ and $i\in \{1,\ldots ,n\}$.
        By definition of $e_P$ it follows that
            \[ 
            v_P(xu_i) = e_Pv_Q(x) + v_P(u_i) \geq 0
            \]
        for all $i\in \{1,\ldots, n\}$ and all $P\in \pi^{-1}(Q)$.
        Since $\cO'_{Y,Q} = \cap_{P\mapsto Q} \cO_{X,P}$ (see, for example, \cite[Cor. 3.3.5]{stichtenoth}), then $x\cdot C_Q \subseteq \cO_{Y,Q}'$.
        Since $\cO_{Y,Q}'$ is a principal ideal domain by Lemma \ref{lemmapidlemma}, it follows that $x\cdot C_Q = y\cdot \cO_{Y,Q}'$ for some $y\in \cO_{Y,Q}'$.
        If we let $t=x^{-1}y$ then $C_Q =t\cdot \cO_{Y,Q}'$, proving the first part of the statement.
        
        
        
        Since $\cO_{Y,Q}'\subseteq C_Q$ then $v_P(t)\leq 0$ for all $P\in \pi^{-1}(Q)$.
        Now $t\cdot \cO_{Y,Q}' = t'\cdot \cO_{Y,Q}'$ if and only if both $tt'^{-1}$ and $t^{-1}t'$ are in $\cO_{Y,Q}'$.
        But this is the case if and only $v_P(tt'^{-1}) \geq 0$ and $v_P(t^{-1}t')\geq 0$ for all $P\in \pi^{-1}(Q)$, which is equivalent to $v_P(t)=v_P(t')$ for all such $P$.
        \end{enumerate}
    \end{proof}

    \begin{prop}\label{almostallqiny}
    For almost all $Q\in Y$ we have $C_Q= \cO_{Y,Q}'$.
    \end{prop}
    \begin{proof}
    We first show that, given a basis of $K(X)$ over $K(Y)$, it is almost always integral over $\cO_{Y,Q}$ given $Q\in Y$.
    Recall that $\cO_{Y,Q}$ is integrally closed in $K(Y)$, and its quotient field is $K(Y)$.
    We consider a basis $z_1,\ldots ,z_n$ of $K(X)$ over $K(Y)$ and we let $z_1^*,\ldots ,z_n^*$ be the dual basis.
    Now the minimal polynomials of $z_1,\ldots, z_n,z_1^*,\ldots, z_n^*$ have finitely many coefficients in $K(Y)$.
    Hence if $S\subseteq Y$ is the set of poles of these coefficients, then $S$ is finite and for $Q\notin S$ then 
        \[
        z_1,\ldots,z_n,z_1^*,\ldots, z_n^*\in \cO_{Y,Q}'.
        \]
    
    Now we fix $Q \notin S$ and assume that $\{z_1,\ldots ,z_n,z_1^*,\ldots, z_n^*\}\subseteq \cO_{Y,Q}'$. 
    Then we show that 
        \[
        \cO_{Y,Q}' \subseteq \sum_{i=1}^n \cO_{Y,Q}\cdot z_i^*.
        \]
    
    If $z\in K(X)$ then there are $e_1,\ldots, e_n\in K(Y)$ such that $z=e_1z_1^*+\ldots +e_nz_n^*$.
    If $z\in \cO_{Y,Q}'$ then $zz_j\in \cO_{Y,Q}'$ for $1\leq j\leq n$, and hence $\tr_{X/Y}(zz_j)\in \cO_{Y,Q}$, by Corollary \ref{traceinclosure}.
    Since
        \[
        \tr_{X/Y}(zz_j) = \tr_{X/Y}\left(\sum_{i=1}^n e_iz_jz_i^*\right) = \sum_{i=1}^ne_i\cdot \tr_{X/Y}(z_jz_i^*) = e_j.
        \]
    then $e_j\in \cO_{Y,Q}$, and hence $\cO_{Y,Q}'\subseteq \sum_{i=1}^n\cO_{Y,Q}\cdot z_i^*$.
    Since $z_1,\ldots, z_n$ also forms a basis we can run the same argument again to show that $\cO_{Y,Q}'\subseteq \sum_{i=1}^n\cO_{Y,Q}\cdot z_i$.
    
    We then have the following set of inequalities:
        \[
        \sum_{i=1}^n \cO_{Y,Q}\cdot z_i \subseteq \cO_{Y,Q}' \subseteq \sum_{i=1}^n\cO_{Y,Q}\cdot z_i^* \subseteq \cO_{Y,Q}'\subseteq \sum_{i=1}^n \cO_{Y,Q}\cdot z_i.
        \]
        Since $C_Q = \sum_{i=1}^n \cO_{Y,Q}\cdot z_i^*$ by part 2 of Proposition \ref{propfactsaboutc'}, the result follows.
    \end{proof}

We can now define the ramification divisor.


    \begin{defn}
    For a point $Q\in X$ choose $t\in K(X)$ such that $C_Q = t\cdot \cO_{X,Q}'$, as in part 3 of Proposition \ref{propfactsaboutc'}.
    Then for any $P\in \pi^{-1}(Q)$ we define the different exponent to be $\delta_P := -v_P(t)$.
    By Proposition \ref{propfactsaboutc'} this is well defined, and by Proposition \ref{almostallqiny} it is almost always zero.
    Hence we can define the ramification divisor to be
        \[
        R := \sum_{P\in X} \delta_P [P].
        \]
    \end{defn}

    \begin{rem}
    It should be noted that when considering the theory of function fields the ramification divisor is called the different, and denoted $\text{ Diff}_{X/Y}$.
    \end{rem}

We now define the \adele space of $X$ over $Y$.

    \begin{defn}
    We define $\mathcal {A}_{X/Y}$ as
        \[
        \mathcal{A}_{X/Y} := \{\alpha \in \mathcal{A}_X | \alpha_P =\alpha_{P'}\ \text{if}\ \cO_{X,P}\cap K(Y) = \cO_{P'}\cap K(Y)\}.
        \]
    We extend the trace function $\tr_{X/Y}\colon K(X)\rightarrow K(Y)$ to a map $\tr_{X/Y}\colon \mathcal{A}_{X/Y} \rightarrow \mathcal{A}_Y$,  by letting
        \[
        (\tr_{X/Y}(\alpha))_Q := \tr_{X/Y}(\alpha_P)
        \]
    for any $\alpha \in \mathcal{A}_{X/Y}$, $Q\in Y$ and $P\in \pi^{-1}(Q)$.
    
    For any divisor $D$ over $X$ we define
        \[
        \mathcal{A}_{X/Y}(D) := \mathcal{A}_X(D) \cap \mathcal{A}_{X/Y}.
        \]
    
    \end{defn}


    \begin{defn}\label{theoremdetailedhurwitz}
    For every differential $\omega\in H^0(Y,\Omega_Y)$ there is a unique $\omega'\in H^0(X,\Omega_X)$ such that
        \[
        \omega'(\alpha) = \omega\left(\tr_{X/Y}(\alpha)\right)
        \]
    for all $\alpha \in {\mathcal A}_{X/Y}$.
    
    This differential is called the pullback of $\omega$, and is denoted $\pi^*(\omega)$. 
    \end{defn}

The following theorem gives a significant strengthening to the standard statement of the Riemann-Hurwitz formula, and gives a deeper understanding of the underlying mechanics.\todo{improve phrasing}
    \begin{thm}
    If $\omega\neq 0$ and $(\omega)$ is the associated divisor, then 
        \[
        \di ( \pi^*(\omega)) = \pi^*(\di(\omega)) + R.
        \]
    \end{thm}

We first note that this immediately implies the Riemann-Hurwitz formula.

    \begin{cor}\label{hur}[Riemann-Hurwitz Formula]
    Given two non-singular projective curves $X$ and $Y$ of genera $g_X$ and $g_Y$ respectively, with a degree $n$ map $\pi\colon X \rightarrow Y$, then
        \[
        2g_X - 2 = n(2g_Y -2) + \deg(R),
        \]
    where $R$ is the ramification divisor of $\pi$.
    \end{cor}
    \begin{proof}
    This follows from Theorem \ref{theoremdetailedhurwitz} and Corollary \ref{dim=gc}, after taking degrees.
    \end{proof}


We now prove some short lemmas that are necessary for the proof of Theorem \ref{theoremdetailedhurwitz}.

% Stichtenoth  Lemma 3.4.9

    \begin{lem}\label{lemmaadelespace}
    For any divisor $D$ over $X$ we have $\mathcal {A}_X = \mathcal{A}_{X/Y} + \mathcal{A}_X(D)$.
    \end{lem}
    \begin{proof}
    Let $\alpha \in \mathcal{A}_X$. Then, by the approximation lemma, for each $Q\in Y$ there is an element $x_Q\in K(X)$ such that 
        \[
        v_P(\alpha_P - x_Q) \geq -v_P(D)
        \]
    for each $P\in \pi^{-1}(Q)$. 
    We then define the \adele $\beta$ such that $\beta_P := x_Q$ for every $P\in \pi^{-1}(Q)$.
    Then $\beta \in \mathcal{A}_{X/Y}$ and the difference $\alpha - \beta$ is in $\mathcal{A}_X(D)$ by definition of $\beta$.
    Hence $\alpha = \beta + (\alpha - \beta) \in \mathcal{A}_{X/Y} + \mathcal{A}_X(D)$.
    \end{proof}

    \begin{lem}\label{lemmapart1}
    We fix $0 \neq \omega \in H^0(Y,\Omega_Y)$ and let $W = \pi^*(\di(\omega)) + R$.
    Then $\psi := \omega\circ \tr_{X/Y} = 0$ is the zero map on $\mathcal{A}_{X/Y}(W) + K(X)$.
    \end{lem}
    \begin{proof}
    We start by noting that since $\tr_{X/Y}$ and $\omega$ are $k$-linear, $\psi$ is too.
    Also, since $\omega$ is zero on $K(Y)$ and $\tr_{X/Y}(K(X)) \subseteq K(Y)$, then $\psi$ is zero on $K(X)$.
    To show that $\psi(\alpha) = 0$ for any $\alpha \in \mathcal{A}_{X/Y}(W)$ then it is sufficient to show that given any $Q\in Y$ and $P\in \pi^{-1}(Q)$ then
        \[
        v_Q(\tr_{X/Y}(\alpha_P)) \geq -v_Q(\omega).
        \]
    
    We choose $x\in K(Y)$ such that $v_Q(x) = v_Q(\omega)$.
    Then
        \begin{align}\label{remark}
        & v_P(x \alpha_P) = v_P(x) + v_P(\alpha_P) \geq e_P v_P(\omega) - v_P(W) \nonumber \\
        & = v_P(\pi^*(\di(\omega)) - W) = -v_P(R) = -\delta_P. 
        \end{align}
    By the definition of $C_Q$ and the ramification divisor, it is clear that $z\in C_Q$ if and only if $v_P(z)\geq -\delta_P$ for all $P\in \pi^{-1}(Q)$.
    It then follows from \eqref{remark} that $x \alpha_P$ is in $C_Q$ and hence that $v_Q(\tr_{X/Y}(x \alpha_P)) \geq 0$, by definition of $C_Q$.
    Since $\tr_{X/Y}(x \alpha_P) = x\cdot \tr_{X/Y}(\alpha_P)$ and $v_Q(x) = v_Q(\omega)$, the proof is complete.
    \end{proof}

    \begin{lem}\label{lemmapart2}
    We choose $\omega$, $W$ and $\psi$ as in Lemma \ref{lemmapart1}.
    If $D$ is a divisor on $X$ with $D \nleq W$ then there exists a $\beta \in \cA_{X/Y}(D)$ such that $\psi(\beta) \neq 0$.
    \end{lem}
    \begin{proof}
    We let $Q\in Y$ be a point such that there is a $P\in \pi^{-1}(Q)$ with $v_{P}(\pi^*(\di(\omega)) - D) < -\delta_P$.
    We know that such a $Q$ exists since $D \nleq W$.
    As before we will denote by $\cO_{Q,Y}'$ the integral closure of $\cO_{Q,Y}$ in $K(X)$.
    We let 
        \[
        J := \{ z\in K(X) | v_{P}(z) \geq v_{P}(\pi^*(\di (\omega)) - D)\ \text{for all}\ P^*\in \pi^{-1}(Q)\}.
        \]
    By the approximation lemma (Lemma \ref{lemmaapproximationlemma}), there exists a $u\in J$ such that 
        \[
        v_{P}(u) = v_{P}(\pi^*(\di (\omega))-D)
        \]
    for all $P\in \pi^{-1}(Q)$, and hence $J\nsubseteq C_{Q}$.
    (As stated in the proof of Lemma \ref{lemmapart1}, $z\in C_Q$ if and only if $v_P(z) \geq -\delta_P$).
    It is clear that $J\cdot \cO_{X,Q}' \subseteq J$, and hence that $\tr_{X/Y}(J) \nsubseteq \cO_{Y,Q}$.
    We let $t$ be an element of $K(Y)$ such that $v_Q(t) = 1$.
    Then there is an $r\in \mathbb N$ such that $t^r\cdot J \subseteq \cO_{Y,Q}'$, and then 
        \[ 
        t^r\cdot \tr_{X/Y}(J) = \tr_{X/Y}(t^r\cdot J) \subseteq \cO_{Y,Q}.
        \]
    It is clear that $t^r\cdot \tr_{X/Y} (J)$ is an ideal of $\cO_{Y,Q}$, and so $\tr_{X/Y}(J) = t^s\cdot \cO_{Y,Q}$ for some negative integer $s$.
    Hence 
        \begin{equation}\label{traceinring}
        t^{-1}\cdot \cO_{Y,Q} \subseteq \tr_{X/Y}(J).
        \end{equation}
    By Proposition \ref{propertyofomega} we can find an $x\in K(Y)$ such that $v_Q(x) = -v_Q(\omega) - 1$ and $\omega_Q(x) \neq 0$.
    If we choose $y\in K(Y)$ such that $v_Q(y) = v_Q(\omega)$, then $xy \in t^{-1}\cO_{Y,Q}$.
    Hence by \eqref{traceinring} there is a $z\in J$ such that $\tr_{X/Y} (z) = xy$.
    Let $\beta \in \mathcal{A}_{X/Y}$ be chosen  such that 
        \begin{equation*}
        \beta_P =
            \begin{cases}
            y^{-1}z & \text{if}\ P\in \pi^{-1}(Q) \\
            0 & \text{otherwise}.
            \end{cases}
        \end{equation*}
    Then for any $P\in \pi^{-1}(Q)$ we have
        \begin{align*}
        v_P(\beta) & =  -v_P(y) + v_P(z) \\
        & \geq  -v_P(\pi^*(\di (\omega))) + v_P(\pi^*(\di (\omega)) - \beta) \\
        & =  -v_P(D),
        \end{align*}
    with the inequality following from the definition of $y$ and $J$.
    Hence $\beta \in \mathcal{A}_{X/Y}(D)$.
    Finally $\omega(\beta) = \omega(\tr_{X/Y}(\beta)) = \omega_Q(x) \neq 0$.
    \end{proof}



We now prove Theorem \ref{theoremdetailedhurwitz}.


    \begin{proof}
    We first construct a differential $\omega'\in H^0(X,\Omega_X)$ for each $\omega\in H^0(Y,\Omega_Y)$ such that $\omega'(\alpha) = \omega(\tr_{X/Y}(\alpha))$ for every $\alpha \in \cA_{X/Y}$.
    If $\omega = 0$ then we can clearly let $\omega' = 0$, so we fix some $0 \neq \omega \in H^0(Y,\Omega_Y)$.
    We let $W' := \pi^*(\di (\omega)) + R$ and we let $\omega_1:= \omega\circ \tr_{X/Y} \colon \mathcal{A}_{X/Y} \rightarrow k$.
    \todo[inline]{Remove $\omega_1$ and just define $\omega_2$ as $\psi$ in terms of trace and $\omega$ later?}
    
    
    By Lemma \ref{lemmaadelespace} for each $\alpha \in \mathcal{A}_X$ there exists some $\beta \in \mathcal{A}_{X/Y}$ and $\gamma \in \mathcal{A}_X(W')$ such that $\alpha = \beta + \gamma$.
    We now define a new differential $\omega_2 \colon  \mathcal{A}_X \rightarrow k$ by letting $\omega_2(\alpha) := \omega_1(\beta)$.
    Suppose we have two representations of $\alpha$, say $\beta+ \gamma$ and $\beta' + \gamma'$, where $\beta, \beta' \in \mathcal{A}_{X/Y}$ and $\gamma, \gamma' \in \mathcal{A}_{X}(W')$.
    Then 
        \[
        \beta - \beta' = \gamma' - \gamma \in \mathcal{A}_{X/Y} \cap \mathcal{A}_X(W') = \mathcal{A}_{X/Y}(W').
        \]
    It then follows from Lemma \ref{lemmapart1} that 
        \[
        \omega_1(\beta) - \omega_1(\beta') = \omega_1(\beta - \beta') = 0.
        \]
    and hence $\omega_2$ is well defined.
    It is also clear that $\omega_2$ is $k$-linear.
    Also, by Lemma \ref{lemmapart1} and Lemma \ref{lemmapart2}, we have:
        \begin{enumerate}[(i)]
        \item $\omega_2(\alpha) = 0$ for all $\alpha \in \mathcal{A}_X(W') + K(X)$.
        \item If $D$ is a divisor on $X$ such that $D\nleq W'$ then there is a $\beta \in \mathcal{A}_X(D)$ with $\omega_2(\beta) \neq 0$.
        \end{enumerate}
    
    
    Now it follows that for $\alpha \in \mathcal{A}_{X/Y}$ we have $\omega_2(\alpha) = \omega_1(\alpha) = \omega(\tr_{X/Y}(\alpha))$.
    This means that we have found the $\omega'$ in the statement of the theorem; namely $\omega' = \omega_2$.
    
    It is clear from (i) and (ii) that $\di(\omega') = W' = \pi^*(\di(\omega)) + R$.
    
    We finally prove the uniqueness of $\omega'$.
    Suppose that $\omega''$ also satisfies 
        \[
        \omega''(\alpha) = \omega(\tr_{X/Y}(\alpha))
        \]
    for all $\alpha\in \cA_{X/Y}$.
    So if we let $\theta = \omega'' - \omega'$, then $\theta(\alpha) = 0$ for all $\alpha \in \cA_{X/Y}$.
    But then if we choose a large enough divisor $D$ in Lemma \ref{lemmaadelespace}, this implies that $\theta$ is zero on $\cA_X$, and hence $\omega' = \omega''$.
    \end{proof}





Let $C$ be a smooth, projective, connected algebraic curve over $k$.
We now show that our two different definitions of $\Omega_{K(C)}$ give rise to isomorphic differentials.
Recall that $K(x)$ is the field of rational functions of the projective line.
By \cite[Prop. 1.7.4]{stichtenoth} there exists a unique differential $\omega \in \Omega_{K(x)}$ such that $\di (\omega) = -2[P_{\infty}]$ and $\omega(\iota_\infty(x^{-1})) = -1$, where $P_\infty \in \mathbb P_k^1$ is the point at infinity on the projective line.


Now for any $z\in K(C) \backslash k$ we have that $k(z)$ is isomorphic to $K(x)$.
Hence if we let $G$ be the Galois group of the extension $[K(C):k(z)]$ then the quotient curve $Y:=X/G$ is isomorphic to the projective line.
We let $f_z\colon C \rightarrow \mathbb P_k^1$ be the corresponding surjective map, and we denote the unique differential described above by $\omega_z$.
We then define $\delta\colon K(C) \rightarrow \Omega_{K(C)}$ to be the map such that if $z\in K(C)\backslash k$ then $\delta (z) := f_z^*(\omega_z)$ and if $y\in k$ then $\delta(y):=0$.
This then induces a map $\mu\colon \Omega_{K(C)} \rightarrow \Omega_{K(C)}$, defined by $z\cdot dx \mapsto z\cdot \delta(x)$Â·

    \begin{thm}
    The map $\mu\colon \Omega_{K(C)} \rightarrow \Omega_{K(C)}$ is an isomorphism.
    \end{thm}
    \begin{proof}
    See \cite[Thm. 4.3.2]{stichtenoth}.
    \end{proof}

We now define the order of a poly-differential at a point.
If we consider an element of the tensor product $\omega \in \Omega_X^{\otimes m}$ then it can be locally written as $y dx_1\otimes \ldots \otimes dx_m$, where $x_i \in K(X)$ for all $1 \leq i \leq m$.
Let $P$ be a point in $X$.
Since each $dx_i$ can be written as $y_i dt$ for some $y_i\in K(X)$ and some uniformising parameter $t$ at $P$, we can rewrite $\omega$ as $y' dt \otimes \ldots \otimes dt$, where $y' = y \cdot y_1 \cdots y_m$.
We then define the order of $\omega$ at $P$ to be $\ord_P(\omega ) := \ord_P(y')$.
In the particular case where $\omega = fdx \otimes \ldots \otimes fdx = f^m dx^{\otimes m}$, then we have $y_1 = \ldots = y_m = z$ for some $z$ when we change $x$ to a uniformising parameter.
Hence in this instance 
    \[ 
    \ord_P(\omega) = \ord_P(z^m) = m\ord_P(z) = m\ord_P(dx).
    \]





It should be noted that in algebraic geometry differentials are normally defined in a different, but equivalent, manner.
Given a ring $K(X)$ and an $K(X)$-module $M$, we call any $K(X)$-linear map $D\colon K(X)\rightarrow M$ satisfying 
    \[
    D(ab) = aD(b) + D(a)b
    \]
for all $a,b\in K(X)$ a {\em derivation}.
There is a unique module, denoted $\Omega_{K(X)}$, with a map $d\colon K(X) \rightarrow \Omega_{K(X)}$, which every derivation must factor through; \ie if $D\colon K(X)\rightarrow M$ is a derivation then there is a unique map $f\colon \Omega_{K(X)}\rightarrow M$ such that $D = f\circ d$.\todo{change $f$}
Given any differential $\omega$, we can write it as $fdx$ for some $x$ and some $f$ in $K(X)$.
This is how we will consider differentials in the other sections of this report.
At the end of this section we will describe an isomorphism between $\Omega_X$ and $\Omega_{K(X)}$.


