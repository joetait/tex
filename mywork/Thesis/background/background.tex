\chapter{Background}\label{chapterbackground}

\todo{Throughout - change definitions to be roman, and the italicise the "definition" part}

In this section we will introduce the basic concepts, notation and terminology required for the study of algebraic curves.

Throughout this thesis $k$ will denote an algebraically closed field of characteristic $p \geq 0$.
It should be noted that while the majority of results in the thesis hold for all characteristics, including $p=0$, our main focus will be on the case $p > 0$.

When we refer to an \emph{algebraic curve} (or often just a \emph{curve}) we will mean a smooth, connected, projective variety of dimension one over $k$.
In particular, we let $\PP_k^1$ be the projective.
Similarly, when we refer to an \emph{affine curve} we mean a smooth, connected, affine variety of dimension one over $k$. % Add if needed
We recall that a morphism of affine curves $X$ and $Y$ is just polynomial map $\phi \colon X \ra Y$.
Then if $X$ and $Y$ are algebraic curves then a map $\phi \colon X \ra Y$ is a morphism if we can write $X = \cup X_i$ and $Y = \cup Y_i$ for open $X_i$ and $Y_i$ such that $\phi(X_i) \subseteq Y_i$ and $\phi|_{X_i}$ is a morphism for every $i$.



\section{Functions and differentials}

In this section we recall the basic results pertaining to functions and differentials on $X$.

A \emph{meromorphic function} on $X$ is any morphism $f \colon X \ra \PP_k^1$, other than the morphism mapping all points to infinity.
The collection of meromorphic functions on $X$ is denoted $K(X)$, and called the \emph{function field} of $X$.\todo{B: and non-constant morphisms}

We recall that the category of algebraic curves is actually equivalent to the category of function fields over $k$ (which can be defined independently of curves as fields of transcendence degree one over $k$).
An overview of this correspondence is given in \cite[Appendix B]{stichtenoth}.
Furthermore, when working over the complex numbers $\CC$ we actually have a triple equivalence of categories.
The category of function fields over $\CC$ and the category of algebraic curves are both equivalent to the category of compact Riemann surfaces. 
A short explanation of the correspondence between complex curves and Riemann surfaces is given in \cite[Chap.\ 1, \S 2]{griffiths}, whilst \cite{miranda} exhibits the connection between all three categories throughout.


Returning to our study of functions on $X$, we recall that a meromorphic function $f$ on $X$ is \emph{regular} on an open set $U \subseteq X$ if the image $f(U)$ lies in $k = \AA_k^1 \subset \PP_k^1$.
We let $H^0(U,\cO_X)$ denote the space of functions in $K(X)$ which are regular on $U$.
Moreover, if $f \in K(X)$ is regular on $X$ we say that $f$ is \emph{regular}, and then $H^0(X,\cO_X)$ is the space of regular functions.
Since $X$ is projective $H^0(X,\cO_X)$ is in fact isomorphic to $k$ --- \ie the only regular functions are constant functions.
The reader should note that we are using sheaf theoretic notation here. 
We will not give details of sheaves and sheaf cohomology (since it will rarely be needed), but we will consistently use the notation, in order to be with consistent with current work in the area.

Given $P \in X$ we say that a meromorphic function $f \in K(X)$ is \emph{regular at $P$} if $f(P) \in k \subset \PP_k^1$.
The collection of functions regular at $P$ form a ring, which we call $\cO_{X,P}$.

    \begin{lem}
    For any $P \in X$ the ring $\cO_{X,P}$ is a discrete valuation ring, with maximal ideal
        \[
        \mathcal {M}_{X,P} := \{ f \in \cO_{X,P} | f(P) = 0 \}.
        \]
    \end{lem}
    \begin{proof}
    See \cite[Chap.\ 1, \S 4]{fulton}.
    \end{proof}

The valuation on $\cO_{X,P}$ can be given as follows.
Let $t \in \cO_{X,P}$ be a generator of $\mathcal{M}_{X,P}$.
Now any $0 \neq f \in \cO_{X,P}$ can be written as $f = ut^n$ for some unique $n \in \ZZ$ and some unit $u \in \cO_{X,P}\backslash \mathcal{M}_{X,P}$.
We then define \emph{the order of $f$ at $P$} to be $\ord_P(f) := n$.
For any $f \in K(X)^*$ and $P \in X$ at least one $f$ or $1/f$ is an element of $ \cO_{X,P}$.
Hence we may extend the definition of $\ord_P$ to the whole $K(X)^*$, by letting $\ord_P(f) := - \ord_P(1/f)$ whenever $f \notin \cO_{X,P}$.
If $\ord_P(f) = n >0$ we say that $f$ has a \emph{zero of order $n$} at $P$, whilst if $\ord_P(f) = n < 0$ then we say that $f$ has a \emph{pole of order $n$} at $P$.
Clearly, for any $f, g \in K(X)$ and $P \in X$, it is true that $\ord_P(fg) = \ord_P(f) + \ord_P(g)$.
We call any element $t \in \cO_{X,P}$ which has order $1$ at $P$ a \emph{uniformising parameter at $P$}.

    \begin{prop}\label{propfinitelymanyzeroesandpoles}
    Any non-zero meromorphic function $f$ on $X$ has finitely many poles and zeroes.
    Moreover, the number of poles and zeroes of $f$ are equal, counting multiplicity; \ie 
        \[
        \sum_{P \in X} \ord_P(f) = 0.
        \]
    \end{prop}
    \begin{proof}
    See \cite[Chap.\ 8, \S 1, Prop.\ 1]{fulton}.
    \end{proof}


We now introduce the concept of a differential on the curve $X$.
Let $R$ be any commutative ring containing $k$ and let $M$ be an $R$-module.
Then a $k$-linear map $D \colon R \ra M$ satisfying $D(fg) = fD(g) + gD(f)$ is called a \emph{derivation} of $R$ in to $M$ over $k$.

There exists a unique module $\Omega_k(R)$, and a derivation $d \colon R \ra \Omega_k(R)$, through which all derivations of $R$ over $k$ must factor.
We can describe this more concretely as the free module generated by $[f]$ for all $f \in K(X)$, quotiented by the relations
    \begin{itemize}
    \item $[f]+[g] = [f+g]$,
    \item $[cf] = c[f]$,
    \item $[fg] = f[g] + g[f]$,
    \end{itemize}
where $f, g \in R$ and $c \in k$.

In particular, when $R = K(X)$ we let $\Omega_{K(X)} := \Omega_k(K(X))$, and we call the map $d \colon K(X) \ra \Omega_{K(X)}$ the \emph{differential map}.
We then call $\Omega_{K(X)}$ the \emph{module of differentials of $X$}, and we call any $ \omega \in \Omega_{K(X)}$ a \emph{meromorphic differential}.

    \begin{prop}\label{propdifferentialsareonedimensional}
    The module of differentials, $\Omega_{K(X)}$, is a one dimensional vector space over $K(X)$.
    \end{prop}
    \begin{proof}
    See \cite[Prop. 1.5.9]{stichtenoth}.
    \end{proof}

We suppose that $P \in X$ and we choose a uniformising parameter $t \in \cO_{X,P}$.
Then for any $ 0 \neq \omega \in \Omega_{K(X)}$ there exists a unique integer $n \in \ZZ$ and unit $u \in \cO_{X,P}$ such that $\omega = ut^ndt$, by Proposition \ref{propdifferentialsareonedimensional}.
Then we define the \emph{order of $\omega$ at $P$} to be $\ord_P(\omega) := n$.

Let $U$ be an open subset of $X$.
We call a differential $\omega$ \emph{holomorphic on $U$} if $\ord_P(\omega) \geq 0$ for all $P \in U$, and we let
    \[
    H^0(U, \Omega_X) := \{ \omega \in \Omega_{K(X)} | \ord_P(\omega) \geq 0\ \text{for all}\ P \in X\}
    \]
be \emph{the space of holomorphic differentials on $U$}.
If $\omega \in \Omega_{K(X)}$ is holomorphic on $X$ we say that $\omega$ is \emph{holomorphic}, and so $\hzero$ is the space of holomorphic differentials.

\section{The Riemann-Roch theorem}

We now recall the relevant facts and definitions needed to state the Riemann-Roch theorem.

We first recall that a \emph{divisor} on $X$ is a finitely supported formal sum 
    \[
    D = \sum_{P \in X} n_P[P],
    \]
with coefficients in $\ZZ$.
The set off all divisors on $X$ forms an additive group, denoted $\di (X)$.
The \emph{degree} of the divisor $D$ is $\deg(D) := \sum_{P \in X} n_P$.


Given any function $f \in K(X)$ we define the \emph{divisor associated to $f$} to be
    \[
    \di(f) := \sum_{P \in X} \ord_P(f) [P].
    \]
Note that by Proposition \ref{propfinitelymanyzeroesandpoles} this has finite support and degree zero.
We call any divisor $D$ which is equal to $\di(f)$ for some $f \in K(X)$ a \emph{principal divisor}.
Is is clear that for any $f, g \in K(X)$ we have $\di(fg) = \di(f) + \di(g)$.
Also, for any $f \in K(X)$ we define $\di_0(f)$ and $\di_\infty (f)$, the \emph{divisor of zeroes} and the \emph{divisor of poles} of $f$ respectively, as follows:
    \[
    \di_0(f) := \sum_{\ord_P(f) >0} \ord_P(f)[P]
    \]
and then
    \[
    \di_\infty(f) := \di_0(f) - \di(f).
    \]

Now for any differential $0 \neq \omega \in \Omega_{K(X)}$ we define the \emph{divisor associated to $\omega$} to be
    \[
    \di(\omega) := \sum_{P \in X} \ord_P(\omega)[P].
    \]
If $W$ is a divisor on $X$ and $W = \di(\omega)$ for some $ \omega \in \Omega_{K(X)}$ then we say that $W$ is a \emph{canonical divisor} on $X$.

The principal divisors of $X$ form a subgroup of $\di(X)$, and we say that two divisors $D, D' \in \di(X)$ are equivalent, denoted $D \sim D'$, if their image in the quotient of $\di(X)$ by the group of principal divisors is the same; \ie if there exists $f \in K(X)$ such that $ D = D' + \di(f)$.
By the following theorem, it makes sense to refer to the (unique) canonical divisor on $X$, up to equivalence, which we write as $K_X$.

    \begin{thm}
    Let $W$ and $W'$ be canonical divisors on $X$.
    Then there exists some $f \in K(X)$ such that $W = W' + \di(f)$.
    Moreover, the divisor $W + \di(f)$ is canonical for every $f \in K(X)$.
    \end{thm}
    \begin{proof}
    For any $f \in K(X)$ and differential $\omega \in \Omega_{K(X)}$ it is true that $\di(f \omega) = \di(f) + \di(\omega)$.
    Then the second statement follows from the fact that $\Omega_{K(X)}$ is a $K(X)$ vector space.


    To prove the first statement, suppose that $\omega, \omega' \in \Omega_{K(X)}$ are differentials such that $W = \di(\omega)$ and $W' = \di(\omega')$.
    Then, by Proposition \ref{propdifferentialsareonedimensional}, there exists an $f \in K(X)$ such that $\omega = f \omega'$.
    We conclude the proof by taking the divisors of both sides of this equation.
    \end{proof}

Given any divisor $D = \sum_{P \in X} n_P[P]$ we let
    \[
    H^0(X,\cO_X(D)) : = \{ f \in K(X) | \ord_P(f) \geq n_P\ \text{for all}\ P \in X\}
    \]
be the \emph{vector space of meromorphic functions associated to $D$}.
Similarly, we let 
    \[
    H^0(X,\Omega_X(D)) :  = \{ \Omega \in \omega_{K(X)} | \ord_P(\omega) \geq n_P \ \text{for all} \ P \in X\}
    \]
be the \emph{vector space of meromorphic differentials associated to $D$}.
In particular, when $D$ is the zero divisor we have $H^0(X,\Omega(0)) = \hzero$, and similarly $H^0(X,\cO_X(0)) = H^0(X,\cO_X)$.

We now state the celebrated Riemann-Roch theorem.

    \begin{thm}[Riemann-Roch theorem]\label{theoremriemannroch}
    Let $D$ be any divisor on $X$, and let $W$ be any canonical divisor on $X$.
    Then
        \[
        \dim_k(H^0(X,\cO_X(D))) = \deg(D) + 1 - g_X + \dim_k(H^0(X,\cO_X(W-D)), 
        \]
    for some constant $g_X \in \ZZ_{\geq 0}$, which is independent of the choice of $W$ and $D$.
    \end{thm}
    \begin{proof}
    See \cite[Chap.\ IV, \S 1, Thm.\ 1.3]{hart} or, for a more elementary approach, \cite[Chap.\ 8, \S 6]{fulton}.
    \end{proof}

    \begin{defn}
    The constant $g_X$ in the statement of the Riemann-Roch theorem is the genus of $X$.
    \end{defn}

The genus is an invariant of fundamental importance in the study of algebraic curves.
In particular, we remark that if $k = \CC$ then the genus of an algebraic curve (also called the arithmetic genus) is the same as the topological genus of the corresponding Riemann surface (the corresponding Riemann surface being found via the equivalence of categories mentioned earlier).

We now give a corollary to the Riemann-Roch theorem, which shows some of the properties of the genus.

    \begin{cor}\label{dim=gc}
    For any canonical divisor $W$ on $X$, we have 
        \[
        \deg(W) = 2g_X-2
        \]
    and 
        \[
        \dim H^0(X,\cO_X(W)) = g_X.
        \]
    \end{cor}
    \begin{proof}
    Since $\dim H^0(X,\cO_X(0)) = 1$ (the only functions with no poles are the constant functions), we have by the Riemann-Roch theorem, 
        \[
        1= \dim H^0(X,\cO_X(0)) = 0 + 1 -g_X + \dim H^0(X,\cO_X(W)).
        \]
    Rearranging this gives the second statement.
    The first statement then follows by rearranging
        \begin{multline*}
        g_X = \dim H^0(X,\cO_X(W)) = \deg(W) + 1 -g_X +  \dim H^0(X,\cO_X(W-W))\\ = \deg(W) + 1 -g_X + 1.
        \end{multline*}
    \end{proof}

\section{Ramification and the Riemann-Hurwitz formula}

In this section we will introduce the concept of ramification, and conclude by stating the Riemann-Hurwitz formula, which relates the canonical divisor of two curves via the ramification divisor.



Let $X$ and $Y$ be curves over $k$.
We begin by defining what it means for a map $\phi \colon X \ra Y$ to be a morphism of curves.
We first note that given a map of sets $\phi \colon X \ra Y$ we have an induced ring homomorphism on the function fields,
    \[
    \phi^* \colon K(Y) \ra K(X),
    \]
given by composition with $\phi$; \ie $\phi^*(f) = f \circ \phi$.
Moreover, it transpires that $\phi^*$ is an injection, and hence we can view $K(Y)$ as a subfield of $K(X)$.
We then define the \emph{degree} of $\phi$ to be the degree of the extension $K(X)/K(Y)$.

Then a \emph{morphism of curves} is a continuous map $\phi \colon X \ra Y$ such that for every open set $U \subseteq Y$ we have
    \[
    \phi^*(H^0(U,\cO_Y)) \subseteq H^0(\phi^{-1}(U),\cO_X).
    \]

Let $G$ be a subgroup of the automorphism group of $X$.
Then have a natural morphism $\pi \colon X \ra X/G$, which is a projection of $X$ on to the quotient of $X$ by the action of $G$.
The majority of the topics considered in this thesis will focussed on situations where we have such a projection.

We now return to assuming that $\phi \colon X \ra Y$ is an arbitrary morphism of curves.
    \begin{defn}
    Let $P \in X$ and choose a uniformising parameter $t \in \cO_{Y,f(P)}$.
    We define the ramification index $e_P$ of $\phi$ at $P$ to be
        \[
        e_P := \ord_P(\phi^*(t)).
        \]
    \end{defn}

Note that $e_P =1$ for almost all points $P \in X$.
We say that the point $Q \in Y$ is a \emph{branch point} of $\phi$ if there exists some $P \in \phi^{-1}(Q)$ for which $e_P >1$.
We say that $P \in X$ is a \emph{ramification point} of $X$ if $e_P >1$.

    
Suppose $P \in X$ is a ramification point.
Then if $p = \cha(k)$ divides $e_P$ we say that $P$ is \emph{wildly ramified}, and we also say $\phi$ is wildly ramified if this holds for any point in $X$.
If $p$ does not divide $e_P$ we say that $P$ is tamely ramified.

    \begin{defn}
    Let $D = \sum_{Q \in Y}n_Q [Q]$ be a divisor on $Y$.
    Then the pull back of $D$ with respect to $\phi$ is
        \[
        \phi^*(D) := \sum_{Q \in Y} \sum_{P \mapsto Q} e_P \cdot n_Q [P].
        \]
    \end{defn}

Note that $\phi^*$ defines a group homomorphism $\di(Y) \ra \di(X)$.


We also define the pullback of a differential $\omega = g\cdot df \in \Omega_{K(Y)}$ by $\phi$ to be
    \[
    \phi^*(\omega) := \phi^*(g)d\phi^*(f).
    \]
Clearly $\phi^*(\omega)$ is a differential on $X$.


Now we describe the different exponent, which we require to define the ramification divisor.
    \begin{defn}\label{definitiondifferent}
    For any $P\in X$ let $Q = \phi(P) \in Y$.
    Moreover, we choose uniformising parameters $s \in \cO_{X,P}$ and $t \in \cO_{Y,Q}$.
    Then by Proposition \ref{propdifferentialsareonedimensional} there exists a unique $f \in K(X)$ such that $\phi^*(dt) = f\cdot ds$.
    Then we define the different exponent at $P$ to be 
        \[
        \delta_P : = \ord_P(f).
        \]
    \end{defn}

Note that since $s$ is a uniformising parameter at $P$, and $\phi^*(t)$ is regular at $P$, it follows that $f$ is regular at $P$; in particular, $\delta_P$ is non-negative for all $P \in X$.
 
    \begin{defn}[Ramification divisor]\label{defnramificationdivisor}
    The ramification divisor of $\phi \colon X \ra Y$ is 
        \[
        R:= \sum_{P \in X} \delta_P [P].
        \]
    If $\phi$ is tamely ramified then 
        \[
        R: = \sum_{P \in X} (e_P - 1)[P].
        \]
    \end{defn}

The following theorem has the classical Riemann-Hurwitz formula as a corollary, but also goes further, actually relating the canonical divisors on $X$ and $Y$.
    \begin{thm}\label{theoremdetailedhurwitz}
    If $0 \neq \omega \in \Omega_{K(Y)}$ then
        \begin{equation}\label{equationstronghurwitzformula}
        \di(\phi^*(\omega)) = \phi^*(\di(\omega)) + R.
        \end{equation}
    In particular, we have
        \[
        K_X \sim \phi^*(K_Y) + R.
        \]
    \end{thm}
    \begin{proof}
    See \cite[Chap.\ IV, \S 2, Prop.\ 2.3]{hart} for a sheaf theoretic approach, or alternatively \cite[Thm. 3.4.6]{stichtenoth}, for a proof involving function fields.
    \end{proof}


As a corollary to this we have the Riemann-Hurwitz formula.
    \begin{cor}\label{corhurwitzformula}[Riemann-Hurwitz Formula]
    Given two non-singular projective curves $X$ and $Y$ of genera $g_X$ and $g_Y$ respectively, with a degree $n$ map $\phi\colon X \rightarrow Y$, then
        \[
        2g_X - 2 = n(2g_Y -2) + \deg(R),
        \]
    where $R$ is the ramification divisor of $\phi$.
    \end{cor}
    \begin{proof}
    This follows from Corollary \ref{dim=gc}, after taking degrees in \eqref{equationstronghurwitzformula}.
    \end{proof}


We will use the above statements in the subsequent sections.
In order to make full use of them however, we need to use Hilbert's formula, which gives an alternative description of $\delta_P$ which is easier to compute.
However, in order to state Hilbert's formula we need to introduce higher ramification groups.
   \begin{defn}
    Let $G:=\gal(X/Y)$ and let $t$ be a uniformising parameter at $P\in X$.
    Then for $i\geq -1$ we define the $i^{th}$ ramification group at $P$, denoted $G_i(P)$, to be the subgroup of $s\in G$ such that $i_G(s) := \ord_P(s(t)-t)$ is at least $i+1$.
    This is	independent of the choice of $t$, see \cite[Chap. IV, \S 1, pg. 62]{localfields}.
    \end{defn}

Note that for any $P\in X$ we have that $G_{-1}(P)=G$, if $i$ is sufficiently large then $G_i(P)$ is trivial and $G_i(P)\supseteq G_{i+1}(P)$.
Also, $G_1$ is a $p$-group and $\ord(G_0(P)/G_1(P))$ is coprime to $p$.
In particular, $\phi$ is tamely ramified at $P$ if and only if $G_1(P)$ is the trivial group.
More details can be found in \cite[Chap. IV, \S 1]{localfields}.%Citation is slightly ambiguous, but only references four pages, so is okay.

Note that $e_P = \ord (G_0(P))$ for any $P \in X$.
We now state Hilbert's formula, relating our presentation of the ramification divisor in Definition \ref{defnramificationdivisor} to the ramification groups, which will make future computations easier.


    \begin{thm}[Hilbert's Formula]\label{hilbertsformula}
    Suppose that $P\in X$ and that $t$ is a uniformising parameter in $\cO_{X,P}$.
    Then we have
        \begin{equation}
        \delta_P = \sum_{s\neq e}i_G(s)=\sum_{j=0}^{\infty}\left(\ord(G_i(P))-1\right),\label{ramdiv}
        \end{equation}
    where $e$ denotes the identity in $G$.
    \end{thm}
    \begin{proof}
    For the sake of brevity we do not prove these statements here. See \cite[Chap. IV, \S 1, Prop. 4]{localfields} for a proof of Hilbert's formula.
    \end{proof}

 
\section{Serre duality for curves}

In this section we give the details of Serre duality, in such a way that we will be able to perform explicit computations using Serre duality in later chapters.


We retain the notations of the previous sections.
We further let $\underline{\Omega}_{K(X)}$ and $\underline{K}(X)$ denote the constant sheaves of $\Omega_{K(X)}$ and $K(X)$ respectively, and $\Omega_X$ denote the sheaf of differentials on $X$.
The following lemma gives us useful descriptions of $\hone$ and $H^1(X,\Omega_X)$.
    \begin{lem}\label{lemmaexactsequenceofhoneandhzero}
    We have canonical exact sequences as follows:
        \begin{equation}\label{equationinitialdualitylesfunctions}
        0 \ra H^0(X,\cO_X) \ra K(X) \ra \bigoplus_{P \in X} K(X)/\cO_{X,P} \rightarrow \hone \ra  0;
        \end{equation}
        \begin{equation}\label{equationinitialdualitysesdifferentials}
        0 \rightarrow \hzero \ra \Omega_{K(X)} \ra \bigoplus_{P \in X}\Omega_{K(X)}/\Omega_{X,P} \rightarrow H^1(X,\Omega_X) \ra 0.
        \end{equation}
    \end{lem}
    \begin{rem}
    Note that a sketch of the proof below can be found in \cite[Pg.\ 248]{hart}.
        \end{rem}
    \begin{proof}
    The short exact sequence
        \begin{equation}\label{equationinitialdualitysesfunctions}
        0 \rightarrow \cO_X \rightarrow \underline{K}(X) \rightarrow \underline{K}(X)/\cO_X \rightarrow 0
        \end{equation}
    is a flasque resolution of $\cO_X$ (see \cite[Chap.\ II, ex.\ 1.16]{hart}).
    
    For each $P \in X$ we have a natural embedding $i\colon \{P\} \hookrightarrow X$, and we view the module $K(X)/\cO_{X,P}$ as a sheaf on the singleton $\{P\}$.
    Then for each $P\in X$ we have the induced sheaf $i_*\left( K(X)/\cO_{X,P} \right)$ on $X$.
    If we consider the direct sum of these induced sheaves over all points $P\in X$ we have the following isomorphism
        \begin{equation}\label{equationsheafisomorphism}
        \underline{K}(X)/\cO_X\cong \bigoplus_{P\in X} i_*\left(K(X)/\cO_{X,P}\right).
        \end{equation}
    
    
    To explain this isomorphism we first construct a map from $\underline{K}(X)/\cO_X$ in to the product $\prod_{P \in X} i_*\left({K(X)}/\cO_{X,P}\right)$, and then show that the image of each element under this map has finite support.
    
    Given $i\colon \{P\} \hookrightarrow X$ we have the following equalities
        \begin{align*}
        i^{-1}\left(\underline{K}(X)/\cO_X\right) & = \left(\underline{K}(X)/\cO_X\right)_P \\
        & = \underline{K}(X)_P/\cO_{X,P} \\
        & = K(X)/\cO_{X,P}.
        \end{align*}
    It follows that for any $P \in X$ we have the adjunction map $\underline{K}(X)/\cO_X \ra i_* \left( K(X)/\cO_{X,P} \right)$.
    Since we have an injection $i$ for every $P \in X$, we can actually produce a map in to the product $\prod_{P \in X} i_*\left(K(X)/\cO_{X,P}\right)$.
    Moreover, the stalk $i_*\left( K(X)/\cO_{X,P} \right)_Q$ is zero for $Q \neq P$ and is $K(X)/\cO_{X,P}$ when $Q = P$.
    Hence the product is actually isomorphic to the sum $\bigoplus_{P \in X} \left( i_*\left(K(X)/\cO_{X,P} \right)\right)$, and from this the isomorphism in \eqref{equationsheafisomorphism} follows.
    
    Replacing $\underline{K}(X)/\cO_X$ by $\bigoplus_{P\in X} i_*\left(K(X)/\cO_{X,P}\right)$ in \eqref{equationinitialdualitysesfunctions} yields
        \begin{equation}\label{equationshortexactsequencefunctionsdirectsum}
        0 \ra \cO_X \ra \underline{K}(X) \ra \bigoplus_{P \in X}i_* \left( K(X)/\cO_{X,P} \right) \ra 0.
        \end{equation}
    Taking cohomology we arrive at the exact sequence \eqref{equationinitialdualitylesfunctions}.
    
    We now perform a similar computation to produce the second exact sequence \eqref{equationinitialdualitysesdifferentials}.
    We start with the short exact sequence
        \[
        0 \ra \Omega_X \ra \underline{\Omega}_{K(X)} \ra \underline{\Omega}_{K(X)}/\Omega_X \ra 0,
        \]
    which is a flasque resolution of $\Omega_X$ (see \cite[Chap.\ II, ex.\ 1.16]{hart}).
    For each $P \in X$ we again have a natural injection $i \colon \{ P \} \hookrightarrow X$, giving rise to the induced sheaf $i_*\left( K(X)/\cO_{X,P} \right)$ on $X$.
    Then we have an isomorphism
        \begin{equation}\label{equationsheafisomorphismdifferentials}
        \underline{\Omega}_{K(X)}/\Omega_X \cong \bigoplus_{P \in X} i_* \left( \Omega_{K(X)}/\Omega_{X,P}\right),
        \end{equation}
    similar to that in \eqref{equationsheafisomorphism}.

    Hence we arrive at the short exact sequence
        \begin{equation}\label{equationshortexactsequencedifferentialsdirectsum}
        0 \ra \Omega_X \ra \underline{\Omega}_{K(X)} \ra \bigoplus_{P \in X} i_* \left( \Omega_{K(X)}/\Omega_{X,P} \right)  \ra 0.
        \end{equation}
    Taking cohomology of this then yields the second exact sequence \eqref{equationinitialdualitysesdifferentials}.
    \end{proof}

    \begin{rem}
        When considering elements of $H^1(X,\Omega_X)$ as elements in the cokernel of the map $\Omega_{K(X)} \ra \bigoplus_{P \in X}\Omega_{K(X)}/\Omega_{X,P}$ above, we will denote them by $\overline{(\omega_P)}_{P \in X}$, where ${(\omega_P)}_{P \in X}\in \bigoplus_{P \in X}\Omega_{K(X)}/\Omega_{X,P}$.
        Similarly, when considering elements of $\hone$ as elements of the cokernel of the map $K(X) \ra \bigoplus_{P \in X}K(X)/\cO_{X,P}$, we will denote them by $\overline{(f_P)}_{P \in X}$, where ${(f_P)}_{P \in X} \in \bigoplus_{P \in X}K(X)/\cO_{X,P}$.
    \end{rem}

The residue map $\res_P \colon \Omega_{K(X)} \ra k$ is of fundamental importance in the computations that follow.
We define the {\em residue map}, $\res_P$, to be the unique map identified in the following theorem.

    \begin{thm}\label{theoremresiduemap}
    For any $P\in X$ there exists a unique $k$-linear map $\res_P \colon \Omega_{K(X)} \ra k$ defined by the following properties:
        \begin{itemize}
            \item $\res_P(\omega) = 0$ for all $\omega \in \Omega_{X,P}$;
            \item $\res_P(f^ndf) = 0$ for all $f \in K(X)^*$ and all $n \neq -1$;
            \item $\res_P(f^{-1}df) = \ord_P(f)$, where $\ord_P(f)$ is the order of $f$ at $P$.
        \end{itemize}
    \end{thm}
    \begin{proof}
    See \cite[Chap.\ II, \S 7 and \S 11]{algebraicgroupsandclassfields} or \cite{residuesofdifferentialsoncurve}.
    \end{proof}


    \begin{thm}[Residue Theorem]\label{theoremresiduetheorem}
    Given any differential $\omega \in \Omega_{K(X)}$ on $X$ then $\sum_{P \in X}\res_P(\omega) = 0$.
    \end{thm}
    \begin{proof}
    See \cite[Chap.\ II, Prop.\ 6]{algebraicgroupsandclassfields} or \cite[Pg.\ 155]{residuesofdifferentialsoncurve}.
    \end{proof}

Since $\Omega_{X,P} \subseteq \ker (\res_P)$, it follows that $\res_P$ is a well defined function on the quotient $\Omega_{K(X)}/\Omega_{X,P}$.
Hence by the residue theorem the map
    \begin{equation*} 
    \bigoplus_{P \in X} \Omega_{K(X)}/\Omega_{X,P} \ra k, \quad (\omega_P)_{P \in X} \mapsto \sum_{P\in X} \res_P(\omega_P)
    \end{equation*} 
vanishes on the image of $\Omega_{K(X)}$, which allows us to make the following definition.
    
    \begin{defn}
    Let $\overline{(\omega_P)}_{P \in X} \in H^1(X,\Omega_X)$.
    Then we define the trace map to be 
        \[
    t \colon H^1\left(X, \Omega_X\right) \ra k, \qquad \overline{(\omega_P)}_{P \in X}  \mapsto \sum_{P \in X} \res_P(\omega_P).
        \]
    \end{defn}

We now use the trace map to define a pairing between the $k$-vector spaces $\hone$ and $\hzero$.
Since $\Omega_{K(X)}$ is a $K(X)$-module, we can define the product map 
    \begin{equation}\label{equationproductmap}
    \hzero \times \hone \ra H^1\left(X, \Omega_X\right), \ (\omega, \overline{(f_P)}_{P \in X}) \mapsto ( \overline {(f  \omega)_P})_{P \in X},
    \end{equation}
where $(f\omega)_P$ denotes the product of $f_P \in K(X)/\cO_{X,P}$ with the residue class of $\omega$ in $\Omega_{K(X)}/\Omega_{X,P}$.

We now combine the product map in \eqref{equationproductmap} with the trace map $t$ to get a map 
    \[
    \hzero \times \hone \ra k,\quad (\omega, \overline{(f_P)}_{P \in X}) \mapsto \langle \omega, \overline{(f_P)}_{P \in X} \rangle := t \left( \overline{(f \omega)}_P \right)_{P \in X}.
    \]

    \begin{thm}\label{theoremserreduality}
    Via the pairing $\langle\ ,\ \rangle$, the $k$-vector spaces $\hone$ and $\hzero$ are dual to each other.
    \end{thm}
    \begin{proof}
    This is a specialisation of \cite[Chap.\ II, Thm.\ 2]{algebraicgroupsandclassfields}.
    \end{proof}

More explicitly, this theorem means the following.
If we fix any $\omega \in \hzero$ we produce a map $\theta(\omega)\colon \hone \ra k$, given by $\theta(\omega)(f) = \langle \omega , f\rangle$.
Similarly, if we fix any $f \in \hone$ then we get a map $\psi(f) \colon \hzero \ra k$.
Then the maps 
    \[
    \psi \colon \hone \ra \hom(H^0(X,\Omega_X),k) \quad
    \text{and} \quad    
    \theta \colon H^0(X,\Omega_X) \ra \hom(\hone, k)
    \]
are isomorphisms.
In particular, given a $k$-basis $\omega_1, \ldots, \omega_g$ of $\hzero$, we can find a basis $f_1, \ldots , f_g$ of $\hone$ such that $\langle \omega_i, f_j \rangle = 1$ for all $1 \leq i \leq n$ and $\langle \omega_i, f)j \rangle = 0$ if $i \neq j$, and likewise, starting with a basis of $\hone$ we can find corresponding basis of $H^0(X,\Omega_X)$. 





















